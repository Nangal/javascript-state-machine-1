{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap d7d3031f8975f3e54638","webpack:///./src/StateMachine.js","webpack:///./src/utils/ValueMap.js","webpack:///./src/utils/utils.js","webpack:///./src/Transition.js","webpack:///./src/Events.js","webpack:///./src/utils/handlers.js"],"names":["StateMachine","scope","config","arguments","length","state","states","transitions","actions","handlers","initialize","parse","prototype","transition","newError","tx","message","Error","add","name","from","to","push","map","replace","test","matches","match","action","shift","stack","op","a","b","Array","isArray","addState","initial","hasOwnProperty","on","defer","defaults","Object","assign","order","update","namespace","type","key","value","signature","event","dispatch","do","can","isPaused","rest","create","exec","go","force","has","end","getActionForState","debug","console","info","warn","cannot","is","indexOf","getStatesFor","getActionsFor","keys","asMap","get","isStarted","isTransitioning","paused","isComplete","final","pause","resume","cancel","clear","reset","set","remove","id","fn","result","log","paths","path","index","target","targets","insert","off","fsm","ValueMap","data","undefined","values","obj","String","split","pop","parent","arr","join","splice","isObject","isString","isFunction","isDefined","isUndefined","trim","toString","call","Function","Transition","handler","params","vars","apply","queue","all","token","Event","concat","ActionEvent","StateEvent","SystemEvent","TransitionEvent","lookup","namespaces","start","change","complete","events","enter","leave","segments","isState","isAction","getTargets","determineValue","ParseResult","forEach","segment","i","char"],"mappings":"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","file":"state-machine.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"StateMachine\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"StateMachine\"] = factory();\n\telse\n\t\troot[\"StateMachine\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap d7d3031f8975f3e54638\n **/","import ValueMap from './utils/ValueMap';\nimport Transition from './Transition';\nimport { SystemEvent, TransitionEvent } from './Events';\nimport { isString, isFunction } from './utils/utils';\nimport { parse } from './utils/handlers'\n\nexport default function StateMachine (scope, config)\n{\n    // allow [scope, config] or [config] as parameters\n    if(arguments.length == 1)\n    {\n        [config, scope] = [scope, null];\n    }\n\n    // assignment\n    this.scope          = scope;\n    this.state          = '';\n    this.states         = [];\n    this.transitions    = new ValueMap();\n    this.actions        = new ValueMap();\n    this.handlers       = new ValueMap();\n\n    // initialize\n    if(config)\n    {\n        this.initialize(config);\n    }\n}\n\nStateMachine.parse = parse;\n\n/**\n * StateMachine prototype\n *\n * The property examples below illustrate a 4-state machine, with states:\n *\n * - intro > settings > summary > end\n *\n * And actions:\n *\n * - back | next | restart | finish\n */\nStateMachine.prototype =\n{\n    // ------------------------------------------------------------------------------------------------\n    // properties\n\n        /**\n         * Available state names\n         *\n         * - [\n         *     intro,\n         *     settings,\n         *     summary,\n         *     final\n         *   ]\n         *\n         * @var {string[]}\n         */\n        states      : null,\n\n        /**\n         * Available transitions for each action\n         *\n         * action.from => to\n         *\n         * - next: {\n         *     intro: settings,\n         *     settings: summary\n         *   },\n         * - back: {\n         *     settings: intro\n         *   },\n         * - restart: {\n         *     summary:intro\n         *   },\n         * - finish: {\n         *     summary:final\n         *   },\n         *\n         * Transitions can also be functions\n         *\n         * - next: {\n         *     intro: function() { return '<random state>' } // jump to a random state\n         *   }\n         *\n         * @var {ValueMap}\n         */\n        transitions : null,\n\n        /**\n         * Actions that are available to be called from each state\n         *\n         * state => [ action, action, ... ]\n         *\n         * - intro: [\n         *     'next'\n         *   ],\n         * - settings: [\n         *     'next',\n         *     'back'\n         *   ],\n         * - summary: [\n         *     'restart'\n         *     'finish',\n         *   ]\n         *\n         * Actions can also be expressed as wildcards\n         *\n         * - intro: [\n         *     '*' // any action is allowed from intro\n         *   ]\n         *\n         * @var {ValueMap}\n         */\n        actions     : null,\n\n        /**\n         * Handler functions that should be called on each action event / state change\n         *\n         * name.type => [ handler, handler, ... ]\n         *\n         * - next: {\n         *   - start: [\n         *       hideModal\n         *     ],\n         *   - end: [\n         *       showModal\n         *     ]\n         *   },\n         * - summary: {\n         *   - enter: [\n         *       resetForm\n         *     ],\n         *   - leave: [\n         *       validateForm,\n         *       postData,\n         *     ]\n         *   },\n         *   ...\n         *\n         * @var {ValueMap}\n         */\n        handlers    : null,\n\n        /**\n         * The current state\n         *\n         * @var {string}\n         */\n        state       : '',\n\n        /**\n         * Any active Transition object that is driving the state change\n         *\n         * @var {Transition}\n         */\n        transition  : null,\n\n        /**\n         * The scope in which to call all handlers\n         *\n         * @var {*}\n         */\n        scope       : null,\n\n        /**\n         * The original config object\n         *\n         * @var {Object}\n         */\n        config      : null,\n\n\n    // ------------------------------------------------------------------------------------------------\n    // private methods\n\n        /**\n         * Initialize the FSM with a config object\n         *\n         * @private\n         * @param config\n         */\n        initialize:function (config)\n        {\n            // assign config\n            this.config     = config;\n\n            // scope\n            if(config.scope)\n            {\n                this.scope = config.scope;\n            }\n\n            // pre-process transitions\n            if(config.transitions)\n            {\n                let transitions = [];\n\n                function newError(tx, message)\n                {\n                    return new Error('Invalid transition shorthand pattern \"' +tx+ '\" - ' + message);\n                }\n\n                function add(name, from, to)\n                {\n                    transitions.push({name, from, to});\n                }\n\n                config.transitions.map( tx =>\n                {\n                    // convert shorthand to objects\n                    if(isString(tx))\n                    {\n                        // pre-process string\n                        tx = tx\n                            .replace(/([|=:<>])/g, ' $1 ')\n                            .replace(/\\s+/g, ' ')\n                            .replace(/^\\s+|\\s+$/g,'');\n\n                        // ensure string is valid\n                        if(!/^\\w+ [:|=] \\w[\\w ]*[<>] \\w[\\w ]*/.test(tx))\n                        {\n                            throw newError(tx, 'cannot determine action and states');\n                        }\n\n                        // initialize variables\n                        let matches = tx.match(/([*\\w ]+|[<>])/g),\n                            action  = matches.shift().replace(/\\s+/g, ''),\n                            stack   = [],\n                            match   = '',\n                            op      = '',\n                            a       = '',\n                            b       = '';\n\n                        // process remaining tokens\n                        while(matches.length)\n                        {\n                            // get the next match\n                            match = matches.shift();\n                            if(/[<>]/.test(match))\n                            {\n                                op = match;\n                            }\n                            else\n                            {\n                                match = match.match(/[*\\w]+/g);\n                                match = match.length === 1 ? match[0] : match;\n                                stack.push(match);\n                            }\n\n                            // process matches if stack is full\n                            if(stack.length === 2)\n                            {\n                                [a, b] = op === '<'\n                                    ? [stack[1], stack[0]]\n                                    : stack;\n                                if(Array.isArray(a) && Array.isArray(b))\n                                {\n                                    throw newError(tx, 'transitioning between 2 arrays doesn\\'t make sense');\n                                }\n                                if(Array.isArray(a))\n                                {\n                                    a.map( a => add(action, a, b) );\n                                }\n                                else if(Array.isArray(b))\n                                {\n                                    b.map( b => add(action, a, b) );\n                                }\n                                else\n                                {\n                                    add(action, a, b);\n                                }\n\n                                // once processed, shift the original\n                                stack.shift();\n                            }\n\n                        }\n                    }\n\n                    // just add objects as-is\n                    else\n                    {\n                        transitions.push(tx);\n                    }\n                });\n\n                // pre-collate all states\n                transitions.map( tx =>\n                {\n                    [tx.from, tx.to].map( state => addState(this, state) );\n                });\n\n                // initial state (must be done after\n                if( ! config.initial )\n                {\n                    config.initial = this.states[0];\n                }\n\n                // add transitions\n                if(Array.isArray(transitions))\n                {\n                    transitions.map( transition =>\n                    {\n                        this.add(transition.name, transition.from, transition.to);\n                    });\n                }\n            }\n\n            // add handlers\n            if(config.handlers)\n            {\n                for(let name in config.handlers)\n                {\n                    if(config.handlers.hasOwnProperty(name))\n                    {\n                        this.on(name, config.handlers[name]);\n                    }\n                }\n            }\n\n            // start automatically unless defer is set to true\n            if( ! config.defer )\n            {\n                this.state = config.initial;\n            }\n\n            /**\n             * Sets defaults for various declarations\n             *\n             * @type {Object}\n             */\n            config.defaults = Object.assign({\n\n                // initialize event\n                initialize  :'initialize',\n\n                // handler defaults\n                action      :'start',\n                state       :'enter'\n\n            }, config.defaults);\n\n            /**\n             * Sets the default order to run transition callbacks in\n             *\n             * @type {string[]} type.target\n             */\n            config.order = config.order ||\n            [\n                'action.*.start',\n                'action.{action}.start',\n                'state.{*}.{action}',\n                'state.{from}.{action}',\n                'state.{from}.leave',\n                'state.*.leave',\n                'state.*.enter',\n                'state.{to}.enter',\n                'action.{action}.end',\n                'action.*.end'\n            ];\n        },\n\n        /**\n         * Dispatch an event\n         *\n         * @param   {string}    namespace\n         * @param   {string}    type\n         * @param   {string}    key\n         * @param   {*}         value\n         * @returns {StateMachine}\n         */\n        update: function (namespace, type, key = '', value = null)\n        {\n            let signature = namespace + '.' + type;\n            let event = namespace === 'system'\n                ? new SystemEvent(type, key, value)\n                : new TransitionEvent(type);\n            this.dispatch(signature, event);\n            return this;\n        },\n\n\n    // ------------------------------------------------------------------------------------------------\n    // api\n\n        /**\n         * Attempt to run an action, resulting in a transition to a state\n         *\n         * @param   {string}    action\n         * @param   {*[]}       rest\n         * @returns {boolean}\n         */\n        do: function (action, ...rest)\n        {\n            if(this.can(action) && !this.isPaused())\n            {\n                this.transition = Transition.create(this, action, rest);\n                if(action === this.config.defaults.initialize)\n                {\n                    this.update('system', 'initialize');\n                }\n                this.update('system', 'update', 'transition', this.transition);\n                this.transition.exec();\n                return true;\n            }\n            return false;\n        },\n\n        /**\n         * Attempt to go to a state\n         *\n         * Finds if an appropriate transition exists, then calls the related action if it does\n         *\n         * @param   {string}    state\n         * @param   {boolean}   [force]\n         * @returns {boolean}\n         */\n        go: function (state, force = false)\n        {\n            if(this.has(state))\n            {\n                if(force)\n                {\n                    this.transition = Transition.force(this, state);\n                    return this.end();\n                }\n                var action = this.getActionForState(state);\n                if(action)\n                {\n                    return this.do(action);\n                }\n                this.config.debug && console.info('No transition exists from \"%s\" to \"%s\"', this.state, state);\n            }\n            else\n            {\n                this.config.debug && console.warn('No such state \"%s\"', state);\n            }\n            return false;\n        },\n\n        /**\n         * Query a transition to see if a named action is available\n         *\n         * @param   {string}    action\n         * @returns {boolean}\n         */\n        can: function (action)\n        {\n            if( ! this.actions.has(action) )\n            {\n                this.config.debug && console.warn('No such action \"%s\"', action);\n            }\n            return !! this.transitions.has(this.state, action);\n        },\n\n        /**\n         * Query a transition to see if a named action is unavailable\n         *\n         * @param   {string}    action\n         * @returns {boolean}\n         */\n        cannot: function (action)\n        {\n            return ! this.can(action);\n        },\n\n        /**\n         * Test if the current state is the same as the supplied one\n         *\n         * @param   {string}    state       A state name to compare against the current state\n         * @returns {boolean}\n         */\n        is: function (state)\n        {\n            if(this.states.indexOf(state) === -1)\n            {\n                this.config.debug && console.warn('No such state \"%s\"', state);\n            }\n            return state === this.state;\n        },\n\n        /**\n         * Test if a state exists\n         *\n         * @param   {string}    state\n         * @return  {boolean}\n         */\n        has: function(state)\n        {\n            return this.states.indexOf(state) !== -1;\n        },\n\n        /**\n         * Get the available \"to\" states for the current or supplied state\n         *\n         * @param   {string}    [state]     Optional name of a state to get states for. Defaults to the current state\n         * @returns {string[]}              An array of string states\n         */\n        getStatesFor: function (state = null)\n        {\n            state       = state || this.state;\n            let actions = this.getActionsFor(state, true);\n            return Object.keys(actions).map( name => actions[name] );\n        },\n\n        /**\n         * Get the available actions (or actions and states) for the current or supplied state\n         *\n         * @param   {string}    [state]     Optional name of a state to get actions for. Defaults to the current state\n         * @param   {boolean}   [asMap]     Optional boolean to return a Object of action:state properties. Defaults to false\n         * @returns {string[]|Object}       An array of string actions, or a hash of action:states\n         */\n        getActionsFor: function (state = '', asMap = false)\n        {\n            state       = state || this.state;\n            let actions = this.transitions.get(state || this.state);\n            if(asMap)\n            {\n                let states  = {};\n                actions.map( action =>\n                {\n                    states[action] = this.actions.get(action + '.' + state);\n                });\n                return states;\n            }\n            else\n            {\n                return actions;\n            }\n        },\n\n        getActionForState: function (state)\n        {\n            if(this.has(state))\n            {\n                let actions = this.getActionsFor(state, true);\n                for(let action in actions)\n                {\n                    if(actions[action] === state)\n                    {\n                        return action;\n                    }\n                }\n            }\n            return null;\n        },\n\n\n    // ------------------------------------------------------------------------------------------------\n    // flags\n\n        /**\n         * Test if the FSM has started\n         *\n         * @returns {boolean}\n         */\n        isStarted: function ()\n        {\n            return this.state !== '';\n        },\n\n        /**\n         * Test if the FSM is transitioning\n         *\n         * @returns {boolean}\n         */\n        isTransitioning: function ()\n        {\n            return !! this.transition;\n        },\n\n        /**\n         * Test if the FSM is paused (whilst transitioning)\n         *\n         * @returns {boolean}\n         */\n        isPaused: function ()\n        {\n            return this.transition\n                ? this.transition.paused\n                : false;\n        },\n\n        /**\n         * Test if the FSM is on the \"final\" state\n         *\n         * @returns {boolean}\n         */\n        isComplete: function ()\n        {\n            return this.state === this.config.final;\n        },\n\n\n    // ------------------------------------------------------------------------------------------------\n    // transitions\n\n        /**\n         * Pause any current transition\n         *\n         * @returns {StateMachine}\n         */\n        pause: function ()\n        {\n            if(this.transition && !this.isPaused())\n            {\n                this.transition.pause();\n                this.update('transition', 'pause');\n                this.update('system', 'update', 'pause', true);\n            }\n            return this;\n        },\n\n        /**\n         * Resume any current transition\n         *\n         * @returns {StateMachine}\n         */\n        resume: function ()\n        {\n            if(this.transition && this.isPaused())\n            {\n                this.update('transition', 'resume');\n                this.update('system', 'update', 'pause', false);\n                this.transition.resume();\n            }\n            return this;\n        },\n\n        /**\n         * Cancel any current transition\n         *\n         * @returns {StateMachine}\n         */\n        cancel: function ()\n        {\n            if(this.transition)\n            {\n                if(this.isPaused())\n                {\n                    this.update('system', 'update', 'pause', false);\n                }\n                this.state = this.transition.from;\n                this.transition.clear();\n                delete this.transition;\n                this.update('transition', 'cancel');\n                this.update('system', 'update', 'transition', null);\n            }\n            return this;\n        },\n\n        /**\n         * End any current transition, skipping remaining handlers\n         *\n         * @returns {StateMachine}\n         */\n        end: function ()\n        {\n            if(this.transition)\n            {\n                if(this.isPaused())\n                {\n                    this.update('system', 'update', 'pause', false);\n                }\n                this.state = this.transition.to;\n                this.transition.clear();\n                delete this.transition;\n                this.update('system', 'change', 'state', this.state);\n                this.update('system', 'update', 'state', this.state);\n                if(this.isComplete())\n                {\n                    this.update('system', 'complete');\n                }\n                this.update('system', 'update', 'transition', null);\n            }\n            return this;\n        },\n\n        /**\n         * Reset the FSM to the initial, or supplied, state\n         *\n         * @returns {StateMachine}\n         */\n        reset:function(initial = '')\n        {\n            let state = initial || this.config.initial;\n            this.update('system', 'reset');\n            if(this.transition)\n            {\n                if(this.isPaused())\n                {\n                    this.update('system', 'update', 'pause', false);\n                }\n                this.transition.clear();\n                delete this.transition;\n                this.update('transition', 'cancel');\n                this.update('system', 'update', 'transition', null);\n            }\n            if(this.state !== state)\n            {\n                this.state = state;\n                this.update('system', 'change', 'state', this.state);\n                this.update('system', 'update', 'state', this.state);\n            }\n            return this;\n        },\n\n\n    // ------------------------------------------------------------------------------------------------\n    // actions\n\n        /**\n         * Add a transition\n         *\n         * @param   {string}    action\n         * @param   {string}    from\n         * @param   {string}    to\n         * @return  {StateMachine}\n         */\n        add: function (action, from, to)\n        {\n            this.actions.set(action + '.' + from, to);\n            this.transitions.add(from, action);\n            addState(this, from);\n            addState(this, to);\n            return this;\n        },\n\n        /**\n         * Remove a transition\n         *\n         * @param   {string}    action\n         * @param   {string}    from\n         * @param   {string}    to\n         * @return  {StateMachine}\n         */\n        remove: function (action, from, to)\n        {\n            this.states.remove(action, from);\n            return this;\n        },\n\n\n    // ------------------------------------------------------------------------------------------------\n    // handlers\n\n        /**\n         * Add an event handler\n         *\n         * Event handler signatures are build from the following grammar:\n         *\n         * - token      foo\n         * - property   .foo\n         * - event      :foo\n         * - action     @foo\n         * - targets    (foo|bar|baz)\n         *\n         * For example:\n         *\n         * - change\n         * - transition.pause\n         * - next:end\n         * - (a|b)@next\n         * - a@next\n         *\n         * The main event types are unique, so can be used without the namespace:\n         *\n         * - change\n         * - pause\n         * - complete\n         * - ...\n         *\n         * If your states and events are unique, they can also be used without qualification.\n         *\n         * See docs and demo for more information\n         *\n         * @param   {string}        id\n         * @param   {Function}      fn\n         * @return  {StateMachine}\n         */\n        on: function (id, fn)\n        {\n            /** @type {ParseResult} */\n            let result = parse(this, id);\n\n            if(this.config.debug)\n            {\n                console.log('StateMachine on: ' + id, [result.namespace, result.type], result.paths)\n            }\n\n            result.paths.map( (path, index) =>\n            {\n                let target = result.targets[index];\n\n                // warn for invalid actions / states\n                if(target !== '*')\n                {\n                    if(result.namespace === 'state')\n                    {\n                        if(this.states.indexOf(target) === -1)\n                        {\n                            this.config.debug && console.warn('StateMachine: Warning assigning state.%s handler; no such state \"%s\"', result.type, target);\n                        }\n                    }\n                    else if(result.namespace === 'action')\n                    {\n                        if(!this.actions.has(target))\n                        {\n                            this.config.debug && console.warn('StateMachine: Warning assigning action.%s handler; no such action \"%s\"', result.type, target);\n                        }\n                    }\n                }\n\n                // check handler is a function\n                if(!isFunction(fn))\n                {\n                    throw new Error('Error assigning ' +result.namespace+ '.' +result.type+ ' handler; callback is not a Function', fn);\n                }\n\n                // assign\n                this.handlers.insert(path, fn);\n            });\n\n            return this;\n        },\n\n        off: function (id, fn)\n        {\n            let result = parse(this, id);\n            result.paths.map( path =>\n            {\n                this.handlers.remove(path, fn)\n            });\n        },\n\n        dispatch: function(path, event)\n        {\n            this.config.debug && console.info('StateMachine: dispatch \"%s\"', path);\n            let handlers = this.handlers.get(path);\n            if(handlers)\n            {\n                handlers.map(fn => fn(event, this) );\n            }\n        }\n\n};\n\nfunction addState (fsm, state)\n{\n    if (isString(state) && fsm.states.indexOf(state) === -1)\n    {\n        fsm.states.push(state);\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/StateMachine.js\n **/","import {isObject, isArray, isDefined, isUndefined} from './utils';\n\n/**\n * Utility class to create, modify and delete nested hashes and values\n *\n * @constructor\n */\nexport default function ValueMap (data)\n{\n    this.data = data || {};\n}\n\nValueMap.prototype =\n{\n    data: null,\n\n    set: function (path, value)\n    {\n        set(this.data, path, value);\n        return this;\n    },\n\n    add:function(path, value)\n    {\n        add(this.data, path, value);\n        return this;\n    },\n\n    insert:function(path, value)\n    {\n        insert(this.data, path, value);\n        return this;\n    },\n\n    get:function(path)\n    {\n        return get(this.data, path);\n    },\n\n    has: function (path, value = undefined)\n    {\n        return has(this.data, path, value)\n    },\n\n    indexOf: function (path, value)\n    {\n        return indexOf(this.data, path, value)\n    },\n\n    remove: function (path, value = undefined)\n    {\n        remove(this.data, path, value);\n        return this;\n    },\n\n    keys:function(path)\n    {\n        return Object.keys(get(this.data, path));\n    },\n\n    values:function(path)\n    {\n        return values(this.data, path);\n    }\n\n};\n\nfunction create(obj, keys)\n{\n    let key;\n    while(keys.length)\n    {\n        key = keys.shift();\n        if( ! isObject(obj[key]) )\n        {\n            obj[key] = {};\n        }\n        obj = obj[key];\n    }\n    return obj;\n}\n\nexport function set(obj, path, value, index = -1)\n{\n    let keys = String(path).split('.'),\n        key  = keys.pop();\n    obj = create(obj, keys);\n    obj[key] = value;\n}\n\nfunction add(obj, path, value)\n{\n    let keys = String(path).split('.'),\n        key  = keys.pop();\n    obj = create(obj, keys);\n    if( ! isArray(obj[key]) )\n    {\n        obj[key] = [];\n    }\n    obj[key].push(value);\n}\n\nfunction insert(obj, path, value)\n{\n    let keys = String(path).split('.'),\n        key  = keys.pop();\n    obj = create(obj, keys);\n    if( ! isArray(obj[key]) )\n    {\n        obj[key] = [];\n    }\n    let parent = obj[key],\n        index = parent.indexOf(value);\n    if(index === -1)\n    {\n        parent.push(value);\n    }\n    else\n    {\n        parent[index] = value;\n    }\n}\n\nexport function get(obj, path)\n{\n    if(isUndefined(path) || path == '')\n    {\n        return obj;\n    }\n\n    let key,\n        keys = String(path).split('.');\n    while(keys.length > 1)\n    {\n        key = keys.shift();\n        if( ! obj.hasOwnProperty(key) )\n        {\n            return;\n        }\n        obj = obj[key];\n    }\n    key = keys.shift();\n    return obj[key];\n}\n\nexport function has(obj, path, value)\n{\n    let parent = get(obj, path);\n    return !! (isArray(parent) && isDefined(value)\n        ? parent.indexOf(value) !== -1\n        : isUndefined(value)\n            ? isDefined(parent)\n            : parent === value);\n}\n\nexport function indexOf (obj, path, value)\n{\n    let arr = get(obj, path);\n    if(isArray(arr))\n    {\n        return arr.indexOf(value);\n    }\n    return -1;\n}\n\nexport function remove(obj, path, value)\n{\n    let parent = obj,\n        keys = String(path || '').split('.'),\n        key = keys.pop();\n\n    if(keys.length)\n    {\n        parent = get(obj, keys.join('.'))\n    }\n    if(isDefined(value) && isArray(parent[key]))\n    {\n        let target = parent[key];\n        var index = target.indexOf(value);\n        if(index > -1)\n        {\n            target.splice(index, 1);\n            if(target.length === 0)\n            {\n                delete parent[key];\n            }\n            return true;\n        }\n        return false;\n    }\n    else\n    {\n        if(isObject(parent) && obj.hasOwnProperty(key))\n        {\n            delete parent[key];\n            return true;\n        }\n    }\n    return false\n}\n\nexport function values(obj, path)\n{\n    var values = [];\n    var target = get(obj, path);\n    if(isObject(target))\n    {\n        for(var name in target)\n        {\n            if(target.hasOwnProperty(name))\n            {\n                values.push(target[name]);\n            }\n        }\n    }\n    return values;\n}\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/utils/ValueMap.js\n **/","export function isObject (value)\n{\n    return Object.prototype.toString.call(value) === '[object Object]';\n}\n\nexport function isArray (value)\n{\n    return value instanceof Array;\n}\n\nexport function isString (value)\n{\n    return typeof value === 'string';\n}\n\nexport function isFunction(value)\n{\n    return value instanceof Function;\n}\n\nexport function isDefined (value)\n{\n    return typeof value !== 'undefined';\n}\n\nexport function isUndefined (value)\n{\n    return typeof value === 'undefined';\n}\n\nexport function trim (value)\n{\n    return String(value || '').replace(/^\\s+|\\s+$/g, '');\n}\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/utils/utils.js\n **/","import { StateEvent, ActionEvent } from './Events';\nimport { isFunction } from './utils/utils';\n\n/**\n * Transition class\n *\n * Responsible for managing events in the flow from state to state.\n *\n * This adds all handlers for the current action start/end and state from/to to an array:\n *\n * - <namespace>.<target>.<type>[]\n *\n * So going from state \"a\" to state \"b\" with action \"next\" should build:\n *\n * - action.*.start[]\n * - action.next.start[]\n * - state.a.leave[]\n * - state.*.leave[]\n * - state.*.enter[]\n * - state.b.enter[]\n * - action.next.end[]\n * - action.*.end[]\n *\n * This can be changed by passing in an order array in fsm.config\n *\n * Event handlers will receive an Event object, along with any passed parameters (from do()) as ...rest parameters.\n *\n * From a callback, you can:\n *\n * - return false to cancel the transition\n * - return true to pause the transition\n * - not return a value (the transition continues)\n *\n * Transitions can also be paused, resumed, or cancelled by calling\n * the appropriate method on, or from:\n *\n * - the event\n * - the transition\n * - the state machine\n *\n * Cancelled transitions will reset the FSM to the previous \"from\" state\n *\n * When the last callback has fired, the main FSM's end() handler will be called and the state will updated\n *\n * @param {StateMachine}    fsm\n * @param {string}          action\n * @param {string}          from\n * @param {string}          to\n */\nfunction Transition (fsm, action, from, to)\n{\n    this.fsm        = fsm;\n    this.action     = action;\n    this.from       = from;\n    this.to         = to;\n    this.clear();\n}\n\n/**\n * @prop {StateMachine}    fsm\n * @prop {string}          action\n * @prop {string}          from\n * @prop {string}          to\n * @prop {Function[]}      handlers\n */\nTransition.prototype =\n{\n    fsm         : null,\n    action      : '',\n    from        : '',\n    to          : '',\n    paused      : false,\n    handlers    : null,\n\n    clear: function ()\n    {\n        this.paused = false;\n        this.handlers = [];\n    },\n\n    /**\n     * Execute the next event's callbacks\n     * @returns {*}\n     */\n\texec: function ()\n\t{\n\t    if( ! this.paused )\n        {\n            if(this.handlers.length)\n            {\n                var handler = this.handlers.shift();\n                var state = handler();\n                if(state === false)\n                {\n                    return this.fsm.cancel();\n                }\n                if(state === true)\n                {\n                    return this.fsm.pause();\n                }\n                this.exec();\n            }\n            else\n            {\n                this.fsm.end();\n            }\n        }\n        return this;\n\t},\n\n    pause: function ()\n    {\n        this.paused = true;\n        return this;\n    },\n\n    resume: function ()\n    {\n        this.paused = false;\n        return this.exec();\n    }\n};\n\nexport default\n{\n    /**\n     * Create the Transition object\n     *\n     * - Set up variables, and queue\n     * - Determine paths to relevant handlers\n     * - Build State and Action Event objects\n     * - Pre-bind all handlers\n     * - Append to queue\n     *\n     * @param {StateMachine}    fsm\n     * @param {string}          action\n     * @param {Array}           params\n     * @returns {Transition}\n     */\n    create:function (fsm, action, params)\n    {\n        // transition properties\n        let scope   = fsm.scope;\n        let from    = fsm.state;\n        let to      = fsm.actions.get(action)[from];\n        let vars    = {action, to, from};\n\n        // handle \"to\" being a function\n        if(isFunction(to))\n        {\n            to = to.apply(scope, params);\n            if(fsm.states.indexOf(to) === -1)\n            {\n                throw new Error('Invalid \"to\" state \"' +to+ '\"');\n            }\n        }\n\n        // transition\n        let queue       = [];\n        let transition  = new Transition(fsm, action, from, to);\n\n        // build handlers array\n        fsm.config.order.map( path =>\n        {\n            // replace path tokens\n            path = path.replace(/{(\\w+)}/g, (all, token) => vars[token]);\n            let handlers = fsm.handlers.get(path);\n\n            // do it!\n            if(handlers)\n            {\n                let [namespace, target, type] = path.split('.');\n                handlers = handlers.map( handler =>\n                {\n                    // build event object\n                    let Event = namespace === 'state' ? StateEvent : ActionEvent;\n                    let event = new Event(type, target, transition);\n\n                    // pre-bind handlers, scopes and params\n                    // this way scope and params don't need to be passed around\n                    // and the call from Transition is always just `value = handler()`\n                    return function()\n                    {\n                        return handler.apply(scope, [event, fsm].concat(params));\n                    }\n                });\n\n                // add to queue\n                queue = queue.concat(handlers);\n            }\n        });\n\n        // return\n        transition.handlers = queue;\n        return transition;\n    },\n\n    force: function(fsm, state)\n    {\n        let transition = new Transition(fsm, '', fsm.state, state);\n        transition.paused = fsm.transition ? fsm.transition.paused : false;\n        return transition;\n    }\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/Transition.js\n **/","// ------------------------------------------------------------------------------------------------\n// setup\n\n    /**\n     * @prop {string}       namespace   The Event namespace; i.e. state or action\n     * @prop {string}       type        The Event type;      i.e. leave/enter (state) or start/end (action)\n     * @prop {string}       target      The Event target;    i.e. intro (state), next (action), or * (all states or types)\n     * @prop {Transition}   transition  The transition which generated the event\n     */\n    let event =\n    {\n        // properties\n        namespace   : null,\n        type        : null,\n        target      : null,\n        transition          : null\n    };\n\n    function initialize (event, namespace, type, target, transition)\n    {\n        event.namespace     = namespace;\n        event.type          = type;\n        event.target        = target;\n        event.transition    = transition;\n    }\n\n\n// ------------------------------------------------------------------------------------------------\n// ActionEvent\n\n    export function ActionEvent (type, target, transition)\n    {\n        initialize(this, 'action' ,type, target, transition);\n    }\n    ActionEvent.prototype = event;\n\n\n// ------------------------------------------------------------------------------------------------\n// StateEvent\n\n    export function StateEvent (type, target, transition)\n    {\n        initialize(this, 'state' ,type, target, transition);\n    }\n    StateEvent.prototype = event;\n\n\n// ------------------------------------------------------------------------------------------------\n// SystemEvent\n\n    export function SystemEvent (type, key, value)\n    {\n        this.type   = type;\n        this.key    = key;\n        this.value  = value;\n    }\n\n    SystemEvent.prototype =\n    {\n        namespace   : 'system',\n        type        : '',\n        key         : '',\n        value       : null\n    };\n\n\n// ------------------------------------------------------------------------------------------------\n// TransitionEvent\n\n    export function TransitionEvent (type)\n    {\n        this.type = type;\n    }\n\n    TransitionEvent.prototype =\n    {\n        namespace   : 'transition',\n        type        : ''\n    };\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/Events.js\n **/","let lookup =\n{\n    namespaces:\n    {\n        start   :'system',\n        change  :'system',\n        update  :'system',\n        complete:'system',\n        reset   :'system',\n        add     :'system',\n        remove  :'system',\n\n        pause   :'transition',\n        resume  :'transition',\n        cancel  :'transition'\n    },\n\n    events:\n    {\n        start   :'action',\n        end     :'action',\n        enter   :'state',\n        leave   :'state'\n    }\n};\n\n/**\n * Parses an event handler id into namespace, type, and target variables\n *\n * @param {StateMachine}    fsm\n * @param {string}          id\n * @return {ParseResult}\n */\nexport function parse(fsm, id)\n{\n    // variables\n    let defaults = fsm.config.defaults,\n        segments,\n        namespace,\n        type,\n        targets;\n\n    // utility functions\n    function isState(value) {\n        return fsm.states.indexOf(value) !== -1;\n    }\n\n    function isAction(value) {\n        return fsm.actions.has(value);\n    }\n\n    function getTargets(value) {\n        return value ? value.match(/\\w[-\\w]*/g) : ['*'];\n    }\n\n    function determineValue(value) {\n\n        // is namespace, i.e. system, transition, state, action\n        if(/^(system|transition|state|action)$/.test(value))\n        {\n            namespace = value;\n        }\n\n        // is shortcut, i.e. update, change, pause, cancel\n        else if(value in lookup.namespaces)\n        {\n            namespace = lookup.namespaces[value];\n            type = value;\n        }\n\n        // is state or action, i.e. a, next\n        else if (isState(value) || isAction(value))\n        {\n            if(!namespace)\n            {\n                namespace = isState(value)\n                    ? 'state'\n                    : 'action';\n            }\n\n            // special case for state with action\n            if(namespace === 'state' && isAction(value))\n            {\n                type = value;\n            }\n\n            if(!targets)\n            {\n                targets = getTargets(value);\n            }\n        }\n\n        // action event, i.e. :event\n        else if(/^(enter|leave)$/.test(value))\n        {\n            type = value;\n        }\n    }\n\n    // process\n    segments    = id.match(/:\\w+|@\\w+|\\(.+?\\)|\\.\\w+|\\w+/g);\n\n    // return an empty result if no matches\n    if(!segments)\n    {\n        return new ParseResult();\n    }\n\n    /**\n     * This is the engine of the parse process\n     *\n     * The regex above matches the grammar of the expression into an array:\n     *\n     * - transition.pause   => [\"transition\", \".pause\"]\n     * - (a|b)@next         => [\"(a|b)\", \"@next\"]\n     * - a@next             => [\"a\", \"@next\"]\n     *\n     * Each segment is then analysed for its type and content, either directly\n     * or via the utility functions above which update the local variables.\n     */\n    segments.forEach(function (segment, i, segments)\n    {\n        // variables\n        let char    = segment[0];\n        let values  = segment.match(/\\w+/g);\n        let value   = values[0];\n        switch(char)\n        {\n            // event\n            case ':':\n                namespace   = lookup.events[value];\n                type        = value;\n                break;\n\n            // action\n            case '@':\n                namespace   = 'state';\n                type        = value;\n                break;\n\n            // targets\n            case '(':\n                targets = values;\n                namespace = isState(values[0]) ? 'state' : 'action';\n                break;\n\n            // property\n            case '.':\n                determineValue(value);\n                break;\n\n            // single word\n            default:\n                determineValue(segment);\n        }\n    });\n\n    // final determination\n    if(!targets)\n    {\n        targets = getTargets();\n    }\n\n    if(!namespace)\n    {\n        namespace = isState(targets[0]) ? 'state' : 'action';\n    }\n\n    if(!type)\n    {\n        type = defaults[namespace];\n    }\n\n    // return result\n    return new ParseResult(namespace, type, targets);\n}\n\nfunction ParseResult (namespace, type, targets)\n{\n    if(namespace)\n    {\n        this.namespace  = namespace;\n        this.type       = type;\n        this.targets    = targets;\n        this.paths      = targets.map( target => {\n            return namespace === 'action' || namespace === 'state'\n                ? [namespace, target, type].join('.')\n                : namespace + '.' + type;\n        });\n    }\n}\n\nParseResult.prototype =\n{\n    namespace   :'',\n    type        :'',\n    targets     :[],\n    paths       :[]\n};\n\n\n/** WEBPACK FOOTER **\n ** ./~/eslint-loader!./src/utils/handlers.js\n **/"],"sourceRoot":""}