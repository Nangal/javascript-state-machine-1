!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("StateMachine",[],e):"object"==typeof exports?exports.StateMachine=e():t.StateMachine=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return t[i].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(1==arguments.length){var n=[t,null];e=n[0],t=n[1]}this.scope=t,this.state="",this.states=[],this.transitions=new h["default"],this.actions=new h["default"],this.handlers=new h["default"],e&&this.initialize(e)}function a(t,e,n){n.map(function(n){return r(t,n[e])})}function r(t,e){(0,p.isString)(e)&&t.states.indexOf(e)===-1&&t.states.push(e)}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(){function t(t,e){var n=[],i=!0,s=!1,a=void 0;try{for(var r,o=t[Symbol.iterator]();!(i=(r=o.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(u){s=!0,a=u}finally{try{!i&&o["return"]&&o["return"]()}finally{if(s)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e["default"]=s;var c=n(1),h=i(c),f=n(3),d=i(f),l=n(4),p=n(2),v=n(5);s.parse=v.parse,s.getPath=v.getPath,s.prototype={states:null,transitions:null,actions:null,handlers:null,state:"",transition:null,scope:null,config:null,initialize:function(t){var e=this;this.config=t,t.scope&&(this.scope=t.scope),a(this,"from",t.events),a(this,"to",t.events),t.initial||(t.initial=this.states[0]),t.events.map(function(t){if((0,p.isString)(t)){var n=t.match(/(\w+)\s*[\|:=]\s*(\w+)\s*([<>-])\s*(\w.*)/),i=u(n,5),s=i[1],a=i[2],r=i[3],o=i[4];if("-"===r)return e.add(s,a,o),void e.add(s,o,a);if("<"===r){var c=[o,a];a=c[0],o=c[1]}e.add(s,a,o)}else e.add(t.name,t.from,t.to)});for(var n in t.handlers)t.handlers.hasOwnProperty(n)&&this.on(n,t.handlers[n]);t.defer||(this.state=t.initial),t.defaults=Object.assign({initialize:"initialize",action:"start",state:"enter"},t.defaults),t.order=t.order||["action.*.start","action.{action}.start","state.{*}.{action}","state.{from}.{action}","state.{from}.leave","state.*.leave","state.*.enter","state.{to}.enter","action.{action}.end","action.*.end"]},update:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=t+"."+e,a="system"===t?new l.SystemEvent(e,n,i):new l.TransitionEvent(e);return this.dispatch(s,a),this},"do":function(t){if(this.can(t)&&!this.isPaused()){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this.transition=d["default"].create(this,t,n),t===this.config.defaults.initialize&&this.update("system","initialize"),this.update("system","update","transition",this.transition),this.transition.exec(),!0}return!1},go:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.has(t)){if(e)return this.transition=d["default"].force(this,t),this.end();var n=this.getActionForState(t);if(n)return this["do"](n);this.config.debug&&console.info('No transition exists from "%s" to "%s"',this.state,t)}else this.config.debug&&console.warn('No such state "%s"',t);return!1},can:function(t){return this.actions.has(t)||this.config.debug&&console.warn('No such action "%s"',t),!!this.transitions.has(this.state,t)},cannot:function(t){return!this.can(t)},is:function(t){return this.states.indexOf(t)===-1&&this.config.debug&&console.warn('No such state "%s"',t),t===this.state},has:function(t){return this.states.indexOf(t)!==-1},getStatesFor:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t=t||this.state;var e=this.getActionsFor(t,!0);return Object.keys(e).map(function(t){return e[t]})},getActionsFor:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e||this.state;var i=this.transitions.get(e||this.state);if(!n)return i;var s=function(){var n={};return i.map(function(i){n[i]=t.actions.get(i+"."+e)}),{v:n}}();return"object"===("undefined"==typeof s?"undefined":o(s))?s.v:void 0},getActionForState:function(t){if(this.has(t)){var e=this.getActionsFor(t,!0);for(var n in e)if(e[n]===t)return n}return null},isStarted:function(){return""!==this.state},isTransitioning:function(){return!!this.transition},isPaused:function(){return!!this.transition&&this.transition.paused},isComplete:function(){return this.state===this.config["final"]},pause:function(){return this.transition&&!this.isPaused()&&(this.transition.pause(),this.update("transition","pause"),this.update("system","update","pause",!0)),this},resume:function(){return this.transition&&this.isPaused()&&(this.update("transition","resume"),this.update("system","update","pause",!1),this.transition.resume()),this},cancel:function(){return this.transition&&(this.isPaused()&&this.update("system","update","pause",!1),this.state=this.transition.from,this.transition.clear(),delete this.transition,this.update("transition","cancel"),this.update("system","update","transition",null)),this},end:function(){return this.transition&&(this.isPaused()&&this.update("system","update","pause",!1),this.state=this.transition.to,this.transition.clear(),delete this.transition,this.update("system","change","state",this.state),this.update("system","update","state",this.state),this.isComplete()&&this.update("system","complete"),this.update("system","update","transition",null)),this},reset:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=t||this.config.initial;return this.update("system","reset"),this.transition&&(this.isPaused()&&this.update("system","update","pause",!1),this.transition.clear(),delete this.transition,this.update("transition","cancel"),this.update("system","update","transition",null)),this.state!==e&&(this.state=e,this.update("system","change","state",this.state),this.update("system","update","state",this.state)),this},add:function(t,e,n){return this.actions.set(t+"."+e,n),this.transitions.add(e,t),this},remove:function(t,e,n){return this.states.remove(t,e),this},on:function(t,e){var n=this,i=(0,v.parse)(this,t);return this.config.debug&&console.log("StateMachine on: "+t,[i.namespace,i.type],i.paths),i.paths.map(function(t,s){var a=i.targets[s];if("*"!==a&&("state"===i.namespace?n.states.indexOf(a)===-1&&n.config.debug&&console.warn('StateMachine: Warning assigning state.%s handler; no such state "%s"',i.type,a):"action"===i.namespace&&(n.actions.has(a)||n.config.debug&&console.warn('StateMachine: Warning assigning action.%s handler; no such action "%s"',i.type,a))),!(0,p.isFunction)(e))throw new Error("Error assigning "+i.namespace+"."+i.type+" handler; callback is not a Function",e);n.handlers.insert(t,e)}),this},off:function(t,e){var n=this,i=(0,v.parse)(this,t);i.paths.map(function(t){n.handlers.remove(t,e)})},dispatch:function(t,e){this.config.debug&&console.info('StateMachine: dispatch "%s"',t);var n=this.handlers.get(t);n&&n.map(function(t){return t(e)})}}},function(t,e,n){"use strict";function i(t){this.data=t||{}}function s(t,e){for(var n=void 0;e.length;)n=e.shift(),(0,l.isObject)(t[n])||(t[n]={}),t=t[n];return t}function a(t,e,n){var i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,String(e).split(".")),a=i.pop();t=s(t,i),t[a]=n}function r(t,e,n){var i=String(e).split("."),a=i.pop();t=s(t,i),(0,l.isArray)(t[a])||(t[a]=[]),t[a].push(n)}function o(t,e,n){var i=String(e).split("."),a=i.pop();t=s(t,i),(0,l.isArray)(t[a])||(t[a]=[]);var r=t[a],o=r.indexOf(n);o===-1?r.push(n):r[o]=n}function u(t,e){if((0,l.isUndefined)(e)||""==e)return t;for(var n=void 0,i=String(e).split(".");i.length>1;){if(n=i.shift(),!t.hasOwnProperty(n))return;t=t[n]}return n=i.shift(),t[n]}function c(t,e,n){var i=u(t,e);return!!((0,l.isArray)(i)&&(0,l.isDefined)(n)?i.indexOf(n)!==-1:(0,l.isUndefined)(n)?(0,l.isDefined)(i):i===n)}function h(t,e,n){var i=u(t,e);return(0,l.isArray)(i)?i.indexOf(n):-1}function f(t,e,n){var i=t,s=String(e||"").split("."),a=s.pop();if(s.length&&(i=u(t,s.join("."))),(0,l.isDefined)(n)&&(0,l.isArray)(i[a])){var r=i[a],o=r.indexOf(n);return o>-1&&(r.splice(o,1),0===r.length&&delete i[a],!0)}return!(!(0,l.isObject)(i)||!t.hasOwnProperty(a))&&(delete i[a],!0)}function d(t,e){var n=[],i=u(t,e);if((0,l.isObject)(i))for(var s in i)i.hasOwnProperty(s)&&n.push(i[s]);return n}Object.defineProperty(e,"__esModule",{value:!0}),e.values=e.remove=e.indexOf=e.has=e.get=e.set=void 0,e["default"]=i;var l=n(2);i.prototype={data:null,set:function(t,e){return a(this.data,t,e),this},add:function(t,e){return r(this.data,t,e),this},insert:function(t,e){return o(this.data,t,e),this},get:function(t){return u(this.data,t)},has:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return c(this.data,t,e)},indexOf:function(t,e){return h(this.data,t,e)},remove:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return f(this.data,t,e),this},keys:function(t){return Object.keys(u(this.data,t))},values:function(t){return d(this.data,t)}},e.set=a,e.get=u,e.has=c,e.indexOf=h,e.remove=f,e.values=d},function(t,e){"use strict";function n(t){return"[object Object]"===Object.prototype.toString.call(t)}function i(t){return t instanceof Array}function s(t){return"string"==typeof t}function a(t){return t instanceof Function}function r(t){return"undefined"!=typeof t}function o(t){return"undefined"==typeof t}function u(t){return String(t||"").replace(/^\s+|\s+$/g,"")}Object.defineProperty(e,"__esModule",{value:!0}),e.isObject=n,e.isArray=i,e.isString=s,e.isFunction=a,e.isDefined=r,e.isUndefined=o,e.trim=u},function(t,e,n){"use strict";function i(t,e,n,i){this.fsm=t,this.action=e,this.from=n,this.to=i,this.clear()}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){var n=[],i=!0,s=!1,a=void 0;try{for(var r,o=t[Symbol.iterator]();!(i=(r=o.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(u){s=!0,a=u}finally{try{!i&&o["return"]&&o["return"]()}finally{if(s)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=n(4),r=n(2);i.prototype={fsm:null,action:"",from:"",to:"",paused:!1,handlers:null,clear:function(){this.paused=!1,this.handlers=[]},exec:function(){if(!this.paused)if(this.handlers.length){var t=this.handlers.shift(),e=t();if(e===!1)return this.fsm.cancel();if(e===!0)return this.fsm.pause();this.exec()}else this.fsm.end();return this},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this.exec()}},e["default"]={create:function(t,e,n){var o=t.scope,u=t.state,c=t.actions.get(e)[u],h={action:e,to:c,from:u};if((0,r.isFunction)(c)&&(c=c.apply(o,n),t.states.indexOf(c)===-1))throw new Error('Invalid "to" state "'+c+'"');var f=[],d=new i(t,e,u,c);return t.config.order.map(function(e){e=e.replace(/{(\w+)}/g,function(t,e){return h[e]});var i=t.handlers.get(e);i&&!function(){var r=e.split("."),u=s(r,3),c=u[0],h=u[1],l=u[2];i=i.map(function(e){var i="state"===c?a.StateEvent:a.ActionEvent,s=new i(l,h,d);return function(){return e.apply(o,[s,t].concat(n))}}),f=f.concat(i)}()}),d.handlers=f,d},force:function(t,e){var n=new i(t,"",t.state,e);return n.paused=!!t.transition&&t.transition.paused,n}}},function(t,e){"use strict";function n(t,e,n,i,s){t.namespace=e,t.type=n,t.target=i,t.transition=s}function i(t,e,i){n(this,"action",t,e,i)}function s(t,e,i){n(this,"state",t,e,i)}function a(t,e,n){this.type=t,this.key=e,this.value=n}function r(t){this.type=t}Object.defineProperty(e,"__esModule",{value:!0}),e.ActionEvent=i,e.StateEvent=s,e.SystemEvent=a,e.TransitionEvent=r;var o={namespace:null,type:null,target:null,transition:null};i.prototype=o,s.prototype=o,a.prototype={namespace:"system",type:"",key:"",value:null},r.prototype={namespace:"transition",type:""}},function(t,e){"use strict";function n(t,e){function n(e){return t.states.indexOf(e)!==-1}function a(e){return t.actions.has(e)}function r(t){return t?t.match(/\w[-\w]*/g):["*"]}function o(t){/^(system|transition|state|action)$/.test(t)?h=t:t in s.namespaces?(h=s.namespaces[t],f=t):n(t)||a(t)?(h||(h=n(t)?"state":"action"),"state"===h&&a(t)&&(f=t),d||(d=r(t))):/^(enter|leave)$/.test(t)&&(f=t)}var u=t.config.defaults,c=void 0,h=void 0,f=void 0,d=void 0;return c=e.match(/:\w+|@\w+|\(.+?\)|\.\w+|\w+/g),c.forEach(function(t,e,i){var a=t[0],r=t.match(/\w+/g),u=r[0];switch(a){case":":h=s.events[u],f=u;break;case"@":h="state",f=u;break;case"(":d=r,h=n(r[0])?"state":"action";break;case".":o(u);break;default:o(t)}}),d||(d=r()),h||(h=n(d[0])?"state":"action"),f||(f=u[h]),new i(h,f,d)}function i(t,e,n){this.namespace=t,this.type=e,this.targets=n,this.paths=n.map(function(n){return"action"===t||"state"===t?[t,n,e].join("."):t+"."+e})}Object.defineProperty(e,"__esModule",{value:!0}),e.parse=n;var s={namespaces:{start:"system",change:"system",update:"system",complete:"system",reset:"system",add:"system",remove:"system",pause:"transition",resume:"transition",cancel:"transition"},events:{start:"action",end:"action",enter:"state",leave:"state"}};i.prototype={namespace:"",type:"",targets:[],paths:[]}}])});
//# sourceMappingURL=state-machine.min.js.map