!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("StateMachine",[],n):"object"==typeof exports?exports.StateMachine=n():t.StateMachine=n()}(this,function(){return function(t){function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,n){this.target=t,this.state="",this.states=[],this.transitions=new h["default"],this.actions=new h["default"],this.handlers=new h["default"],n&&(this.initialize(n),this.update("started")),console.log("hello there")}function s(t,n,e){e.map(function(e){return o(t,e[n])})}function o(t,n){(0,v.isString)(n)&&t.states.indexOf(n)===-1&&t.states.push(n)}function a(t,n,e){for(var i=arguments.length,r=Array(i>3?i-3:0),s=3;s<i;s++)r[s-3]=arguments[s];1===r.length&&(r=["*",r[0]]);var o=r,a=c(o,2),u=a[0],f=a[1],h=(0,v.isArray)(u)?u:""==u?["*"]:u.match(/\*|\w+[-\w]+/g);h.map(function(i){if("*"!==i&&("state"===n&&t.states.indexOf(i)===-1?t.config.debug&&console.warn('Warning assigning state.%s handler: no such state "%s"',e,i):"action"!==n||t.transitions.has(i)||t.config.debug&&console.warn('Warning assigning action.%s handler: no such action "%s"',e,i)),!(0,v.isFunction)(f))throw new Error("Error assigning "+e+"."+i+" handler; callback is not a Function",f);t.handlers.insert([n,i,e].join("."),f)})}Object.defineProperty(n,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=function(){function t(t,n){var e=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(e.push(o.value),!n||e.length!==n);i=!0);}catch(u){r=!0,s=u}finally{try{!i&&a["return"]&&a["return"]()}finally{if(r)throw s}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n["default"]=r;var f=e(1),h=i(f),l=e(3),d=i(l),p=e(4),v=e(2);r.prototype={states:null,transitions:null,actions:null,handlers:null,state:"",transition:null,target:null,config:null,initialize:function(t){var n=this;this.config=t,s(this,"from",t.events),s(this,"to",t.events),t.initial||(t.initial=this.states[0]),t.events.map(function(t){if((0,v.isString)(t)){var e=t.match(/(\w+)\s*[\|:=]\s*(\w+)\s*([<>-])\s*(\w.*)/),i=c(e,5),r=i[1],s=i[2],o=i[3],a=i[4];if("-"===o)return n.add(r,s,a),void n.add(r,a,s);if("<"===o){var u=[a,s];s=u[0],a=u[1]}n.add(r,s,a)}else n.add(t.name,t.from,t.to)});for(var e in t.handlers)if(t.handlers.hasOwnProperty(e)){var i=t.handlers[e],r=e.match(/(\w+)\s*(.*)/);if(r){var o=c(r,3),a=o[1],u=o[2];switch(a){case"start":this.onStart(u,i);break;case"end":this.onEnd(u,i);break;case"leave":this.onLeave(u,i);break;case"enter":this.onEnter(u,i);break;default:this.config.debug&&console.warn('Warning processing handlers config: unknown action type "'+a+'"')}}else this.config.debug&&console.warn('Warning processing handlers config: unable to parse action key "'+e+'"')}t.defer||(this.state=t.initial)},update:function(t){this.config.debug&&console.info('StateMachine update "%s"',t);var n=this.handlers.data.change;n&&!function(){var e=new p.ChangeEvent(t);n.map(function(t){return t(e)})}()},"do":function(t){if(this.can(t)){this.config.debug&&console.info('Doing action "%s"',t);for(var n=arguments.length,e=Array(n>1?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];return this.transition=d["default"].create(this,t,e),this.update("transitioning"),this.transition.exec(),!0}return!1},go:function(t){if(this.has(t)){var n=this.getActionForState(t);if(n)return this["do"](n);this.config.debug&&console.info('No transition exists from "%s" to "%s"',this.state,t)}else this.config.debug&&console.warn('No such state "%s"',t);return!1},can:function(t){return this.actions.has(t)||this.config.debug&&console.warn('No such action "%s"',t),!!this.transitions.has(this.state,t)},cannot:function(t){return!this.can(t)},is:function(t){return this.states.indexOf(t)===-1&&this.config.debug&&console.warn('No such state "%s"',t),t===this.state},has:function(t){return this.states.indexOf(t)!==-1},getStatesFor:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t=t||this.state;var n=this.getActionsFor(t,!0);return Object.keys(n).map(function(t){return n[t]})},getActionsFor:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=n||this.state;var i=this.transitions.get(n||this.state);if(!e)return i;var r=function(){var e={};return i.map(function(i){e[i]=t.actions.get(i+"."+n)}),{v:e}}();return"object"===("undefined"==typeof r?"undefined":u(r))?r.v:void 0},getActionForState:function(t){if(this.has(t)){var n=this.getActionsFor(null,!0);for(var e in n)if(n[e]===t)return e}return null},isStarted:function(){return""!==this.state},isFinished:function(){return this.state===this.config["final"]},isTransitioning:function(){return!!this.transition},isPaused:function(){return!!this.transition&&this.transition.paused},pause:function(){return this.transition&&(this.transition.pause(),this.update("paused")),this},resume:function(){return this.transition&&(this.update("resumed"),this.transition.resume()),this},cancel:function(){return this.transition&&(this.state=this.transition.from,this.transition.clear(),delete this.transition,this.update("cancelled")),this},complete:function(){return this.transition&&(this.state=this.transition.to,this.transition.clear(),delete this.transition,this.update("transitioned"),this.isFinished()&&this.update("finished")),this},reset:function(t){return this.state=t||this.config.initial,this.transition&&(this.transition.clear(),delete this.transition),this.update("reset"),this},add:function(t,n,e){return this.actions.set(t+"."+n,e),this.transitions.add(n,t),this},remove:function(t,n,e){this.states.remove(t,n)},onChange:function(t){return this.handlers.add("change",t),this},onStart:function(t,n){return a(this,"action","start",t,n),this},onEnd:function(t,n){return a(this,"action","end",t,n),this},onEnter:function(t,n){return a(this,"state","enter",t,n),this},onLeave:function(t,n){return a(this,"state","leave",t,n),this},off:function(t,n,e){return this}}},function(t,n,e){"use strict";function i(t){this.data=t||{}}function r(t,n){for(var e=void 0;n.length;)e=n.shift(),(0,d.isObject)(t[e])||(t[e]={}),t=t[e];return t}function s(t,n,e){var i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,String(n).split(".")),s=i.pop();t=r(t,i),t[s]=e}function o(t,n,e){var i=String(n).split("."),s=i.pop();t=r(t,i),(0,d.isArray)(t[s])||(t[s]=[]),t[s].push(e)}function a(t,n,e){var i=String(n).split("."),s=i.pop();t=r(t,i),(0,d.isArray)(t[s])||(t[s]=[]);var o=t[s],a=o.indexOf(e);a===-1?o.push(e):o[a]=e}function u(t,n){if((0,d.isUndefined)(n)||""==n)return t;for(var e=void 0,i=String(n).split(".");i.length>1;){if(e=i.shift(),!t.hasOwnProperty(e))return;t=t[e]}return e=i.shift(),t[e]}function c(t,n,e){var i=u(t,n);return!!((0,d.isArray)(i)&&(0,d.isDefined)(e)?i.indexOf(e)!==-1:(0,d.isUndefined)(e)?(0,d.isDefined)(i):i===e)}function f(t,n,e){var i=u(t,n);return(0,d.isArray)(i)?i.indexOf(e):-1}function h(t,n,e){var i=t,r=String(n||"").split("."),s=r.pop();if(r.length&&(i=u(t,r.join("."))),(0,d.isDefined)(e)&&(0,d.isArray)(i[s])){i=i[s];var o=i.indexOf(e);return o>-1&&(i.splice(o,1),!0)}return!(!(0,d.isObject)(i)||!t.hasOwnProperty(s))&&(delete i[s],!0)}function l(t,n){var e=[],i=u(t,n);if((0,d.isObject)(i))for(var r in i)i.hasOwnProperty(r)&&e.push(i[r]);return e}Object.defineProperty(n,"__esModule",{value:!0}),n.values=n.remove=n.indexOf=n.has=n.get=n.set=void 0,n["default"]=i;var d=e(2);i.prototype={data:null,set:function(t,n){return s(this.data,t,n),this},add:function(t,n){return o(this.data,t,n),this},insert:function(t,n){return a(this.data,t,n),this},get:function(t){return u(this.data,t)},has:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return c(this.data,t,n)},indexOf:function(t,n){return f(this.data,t,n)},remove:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return h(this.data,t,n),this},keys:function(t){return Object.keys(u(this.data,t))},values:function(t){return l(this.data,t)}},n.set=s,n.get=u,n.has=c,n.indexOf=f,n.remove=h,n.values=l},function(t,n){"use strict";function e(t){return"[object Object]"===Object.prototype.toString.call(t)}function i(t){return t instanceof Array}function r(t){return"string"==typeof t}function s(t){return t instanceof Function}function o(t){return"undefined"!=typeof t}function a(t){return"undefined"==typeof t}function u(t){return String(t||"").replace(/^\s+|\s+$/g,"")}Object.defineProperty(n,"__esModule",{value:!0}),n.isObject=e,n.isArray=i,n.isString=r,n.isFunction=s,n.isDefined=o,n.isUndefined=a,n.trim=u},function(t,n,e){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,n,e,i,r){this.action=t,this.from=n,this.to=e,this.handlers=i,this.callbacks=r}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,n){var e=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(e.push(o.value),!n||e.length!==n);i=!0);}catch(u){r=!0,s=u}finally{try{!i&&a["return"]&&a["return"]()}finally{if(r)throw s}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e(4),a=i(o),u=e(2);r.prototype={action:"",from:"",to:"",handlers:null,callbacks:null,paused:!1,clear:function(){this.paused=!1,this.handlers=[]},exec:function(){if(!this.paused)if(this.handlers.length){var t=this.handlers.shift(),n=t();if(n===!1)return this.callbacks.cancel();if(n===!0)return this.callbacks.pause();this.exec()}else this.callbacks.complete();return this},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this.exec()}};var c=["*.start","action.start","from.leave","*.leave","*.enter","to.enter","action.end","*.end"];r.order=c,n["default"]={create:function(t,n,e){var i=t.state,o=t.actions.get(n)[i],c=t.target;if((0,u.isFunction)(o)){var f=t.getActionsFor(),h=o.apply(c,[f].concat(e)),l=t.getActionsFor(h);if(!l)throw new Error('Cannot go to state "'+h+'" from current state "'+i+'"')}var d={cancel:t.cancel.bind(t),pause:t.pause.bind(t),resume:t.resume.bind(t),complete:t.complete.bind(t)},p=[];return r.order.map(function(r){var u=r.split("."),f=s(u,2),h=f[0],l=f[1],v=/^(start|end)$/.test(l)?"action":"state",g=void 0;g="*"===h?"*":"action"==v?n:"leave"===l?i:o;var y=[v,g,l].join("."),m=t.handlers.get(y);m&&(m=m.map(function(t){return function(){var n=a["default"].create(v,d,g,l,i,o);t.apply(c,[n].concat(e))}}),p=p.concat(m))}),new r(n,i,o,p,d)},setOrder:function(t){r.order=t||c},getOrder:function(){return r.order}}},function(t,n){"use strict";function e(){}function i(t,n,e,i,r,s,o){t.type=e,t.name=i,t.verb=r,t.from=s,t.to=o,t.pause=n.pause,t.resume=n.resume,t.cancel=n.cancel,t.complete=n.complete}function r(t,n,e,r,s){i(this,t,"action",n,e,r,s)}function s(t,n,e,r,s){i(this,t,"state",n,e,r,s)}function o(t){this.type=t}Object.defineProperty(n,"__esModule",{value:!0}),n.ActionEvent=r,n.StateEvent=s,n.ChangeEvent=o;var a={type:null,name:null,verb:null,from:null,to:null,pause:e,resume:e,cancel:e};r.prototype=a,s.prototype=a,o.prototype={type:""},n["default"]={create:function(t,n,e,i,o,a){var u="state"==t?s:r;return new u(n,e,i,o,a)}}}])});
//# sourceMappingURL=state-machine.min.js.map