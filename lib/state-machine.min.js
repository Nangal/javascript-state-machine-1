!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("StateMachine",[],n):"object"==typeof exports?exports.StateMachine=n():t.StateMachine=n()}(this,function(){return function(t){function n(i){if(e[i])return e[i].exports;var s=e[i]={exports:{},id:i,loaded:!1};return t[i].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function s(t,n){this.scope=t,this.state="",this.states=[],this.transitions=new l["default"],this.actions=new l["default"],this.handlers=new l["default"],n&&(this.initialize(n),this.update("system","initialize"))}function r(t,n,e){e.map(function(e){return a(t,e[n])})}function a(t,n){(0,y.isString)(n)&&t.states.indexOf(n)===-1&&t.states.push(n)}function o(t,n,e,i,s){if("*"!==i&&("state"===n&&t.states.indexOf(i)===-1?t.config.debug&&console.warn('Warning assigning state.%s handler: no such state "%s"',e,i):"action"!==n||t.actions.has(i)||t.config.debug&&console.warn('Warning assigning action.%s handler: no such action "%s"',e,i)),!(0,y.isFunction)(s))throw new Error("Error assigning "+n+"."+e+" handler; callback is not a Function",s);var r="action"===n||"state"===n?[n,i,e].join("."):n+"."+e;t.handlers.insert(r,s)}function u(t,n){var e=n.match(/^(?:(\w+)\.)?(\w+[-.\w]*)(?::(.*))?/);if(!e)throw new Error('Warning parsing event handler: invalid signature "%s"',n);var i=f(e,4),s=i[1],r=i[2],a=i[3];s||(s=g[r],s||(t.states.indexOf(r)!==-1?(a=r,s="state",r="enter"):t.actions.has(r)?(a=r,s="action",r="start"):t.config.debug&&console.warn('Warning parsing event handler: unable to map "%s" to a valid event or existing entity',n)));var o=a?a.match(/[*\w]+/g):["*"];return[s,r,o]}Object.defineProperty(n,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=function(){function t(t,n){var e=[],i=!0,s=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(i=(a=o.next()).done)&&(e.push(a.value),!n||e.length!==n);i=!0);}catch(u){s=!0,r=u}finally{try{!i&&o["return"]&&o["return"]()}finally{if(s)throw r}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n["default"]=s;var h=e(1),l=i(h),d=e(3),p=i(d),v=e(4),y=e(2);s.prototype={states:null,transitions:null,actions:null,handlers:null,state:"",transition:null,scope:null,config:null,initialize:function(t){var n=this;this.config=t,r(this,"from",t.events),r(this,"to",t.events),t.initial||(t.initial=this.states[0]),t.events.map(function(t){if((0,y.isString)(t)){var e=t.match(/(\w+)\s*[\|:=]\s*(\w+)\s*([<>-])\s*(\w.*)/),i=f(e,5),s=i[1],r=i[2],a=i[3],o=i[4];if("-"===a)return n.add(s,r,o),void n.add(s,o,r);if("<"===a){var u=[o,r];r=u[0],o=u[1]}n.add(s,r,o)}else n.add(t.name,t.from,t.to)});for(var e in t.handlers)t.handlers.hasOwnProperty(e)&&this.on(e,t.handlers[e]);t.defer||(this.state=t.initial),t.order=t.order||["start:*","start:action","leave:from","leave:*","enter:*","enter:to","end:action","end:*"]},update:function(t,n){var e="system"===t?v.SystemEvent:v.TransitionEvent;return this.dispatch(t+"."+n,new e(n)),this},"do":function(t){if(this.can(t)){this.config.debug&&console.info('Doing action "%s"',t);for(var n=arguments.length,e=Array(n>1?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];return this.transition=p["default"].create(this,t,e),this.update("transition","start"),this.update("system","update"),this.transition.exec(),!0}return!1},go:function(t){if(this.has(t)){var n=this.getActionForState(t);if(n)return this["do"](n);this.config.debug&&console.info('No transition exists from "%s" to "%s"',this.state,t)}else this.config.debug&&console.warn('No such state "%s"',t);return!1},can:function(t){return this.actions.has(t)||this.config.debug&&console.warn('No such action "%s"',t),!!this.transitions.has(this.state,t)},cannot:function(t){return!this.can(t)},is:function(t){return this.states.indexOf(t)===-1&&this.config.debug&&console.warn('No such state "%s"',t),t===this.state},has:function(t){return this.states.indexOf(t)!==-1},getStatesFor:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t=t||this.state;var n=this.getActionsFor(t,!0);return Object.keys(n).map(function(t){return n[t]})},getActionsFor:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=n||this.state;var i=this.transitions.get(n||this.state);if(!e)return i;var s=function(){var e={};return i.map(function(i){e[i]=t.actions.get(i+"."+n)}),{v:e}}();return"object"===("undefined"==typeof s?"undefined":c(s))?s.v:void 0},getActionForState:function(t){if(this.has(t)){var n=this.getActionsFor(null,!0);for(var e in n)if(n[e]===t)return e}return null},isStarted:function(){return""!==this.state},isTransitioning:function(){return!!this.transition},isPaused:function(){return!!this.transition&&this.transition.paused},isComplete:function(){return this.state===this.config["final"]},pause:function(){return this.transition&&(this.transition.pause(),this.update("transition","pause"),this.update("system","update")),this},resume:function(){return this.transition&&(this.update("transition","resume"),this.update("system","update"),this.transition.resume()),this},cancel:function(){return this.transition&&(this.state=this.transition.from,this.transition.clear(),delete this.transition,this.update("transition","cancel"),this.update("system","update")),this},end:function(){return this.transition&&(this.state=this.transition.to,this.transition.clear(),delete this.transition,this.update("system","change"),this.update("system","update"),this.isComplete()&&this.update("system","complete"),this.update("transition","end")),this},reset:function(t){return this.state=t||this.config.initial,this.transition&&(this.transition.clear(),delete this.transition),this.update("system","reset"),this},add:function(t,n,e){return this.actions.set(t+"."+n,e),this.transitions.add(n,t),this},remove:function(t,n,e){this.states.remove(t,n)},on:function(t,n){var e=this,i=u(this,t),s=f(i,3),r=s[0],a=s[1],c=s[2];return c.map(function(t){return o(e,r,a,t,n)}),this},off:function(t,n){var e=u(this,t),i=f(e,3);i[0],i[1],i[2];this.handlers.remove(path,n)},dispatch:function(t,n){this.config.debug&&console.info('StateMachine update "%s"',t);var e=this.handlers.get(t);e&&e.map(function(t){return t(n)})}};var g={change:"system",update:"system",complete:"system",reset:"system",add:"state",remove:"state",leave:"state",enter:"state",start:"action",end:"action",pause:"transition",resume:"transition",cancel:"transition"}},function(t,n,e){"use strict";function i(t){this.data=t||{}}function s(t,n){for(var e=void 0;n.length;)e=n.shift(),(0,d.isObject)(t[e])||(t[e]={}),t=t[e];return t}function r(t,n,e){var i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,String(n).split(".")),r=i.pop();t=s(t,i),t[r]=e}function a(t,n,e){var i=String(n).split("."),r=i.pop();t=s(t,i),(0,d.isArray)(t[r])||(t[r]=[]),t[r].push(e)}function o(t,n,e){var i=String(n).split("."),r=i.pop();t=s(t,i),(0,d.isArray)(t[r])||(t[r]=[]);var a=t[r],o=a.indexOf(e);o===-1?a.push(e):a[o]=e}function u(t,n){if((0,d.isUndefined)(n)||""==n)return t;for(var e=void 0,i=String(n).split(".");i.length>1;){if(e=i.shift(),!t.hasOwnProperty(e))return;t=t[e]}return e=i.shift(),t[e]}function c(t,n,e){var i=u(t,n);return!!((0,d.isArray)(i)&&(0,d.isDefined)(e)?i.indexOf(e)!==-1:(0,d.isUndefined)(e)?(0,d.isDefined)(i):i===e)}function f(t,n,e){var i=u(t,n);return(0,d.isArray)(i)?i.indexOf(e):-1}function h(t,n,e){var i=t,s=String(n||"").split("."),r=s.pop();if(s.length&&(i=u(t,s.join("."))),(0,d.isDefined)(e)&&(0,d.isArray)(i[r])){i=i[r];var a=i.indexOf(e);return a>-1&&(i.splice(a,1),!0)}return!(!(0,d.isObject)(i)||!t.hasOwnProperty(r))&&(delete i[r],!0)}function l(t,n){var e=[],i=u(t,n);if((0,d.isObject)(i))for(var s in i)i.hasOwnProperty(s)&&e.push(i[s]);return e}Object.defineProperty(n,"__esModule",{value:!0}),n.values=n.remove=n.indexOf=n.has=n.get=n.set=void 0,n["default"]=i;var d=e(2);i.prototype={data:null,set:function(t,n){return r(this.data,t,n),this},add:function(t,n){return a(this.data,t,n),this},insert:function(t,n){return o(this.data,t,n),this},get:function(t){return u(this.data,t)},has:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return c(this.data,t,n)},indexOf:function(t,n){return f(this.data,t,n)},remove:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return h(this.data,t,n),this},keys:function(t){return Object.keys(u(this.data,t))},values:function(t){return l(this.data,t)}},n.set=r,n.get=u,n.has=c,n.indexOf=f,n.remove=h,n.values=l},function(t,n){"use strict";function e(t){return"[object Object]"===Object.prototype.toString.call(t)}function i(t){return t instanceof Array}function s(t){return"string"==typeof t}function r(t){return t instanceof Function}function a(t){return"undefined"!=typeof t}function o(t){return"undefined"==typeof t}function u(t){return String(t||"").replace(/^\s+|\s+$/g,"")}Object.defineProperty(n,"__esModule",{value:!0}),n.isObject=e,n.isArray=i,n.isString=s,n.isFunction=r,n.isDefined=a,n.isUndefined=o,n.trim=u},function(t,n,e){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function s(t,n,e,i,s){this.action=t,this.from=n,this.to=e,this.handlers=i,this.callbacks=s}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){var e=[],i=!0,s=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(i=(a=o.next()).done)&&(e.push(a.value),!n||e.length!==n);i=!0);}catch(u){s=!0,r=u}finally{try{!i&&o["return"]&&o["return"]()}finally{if(s)throw r}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=e(4),o=i(a),u=e(2);s.prototype={action:"",from:"",to:"",handlers:null,callbacks:null,paused:!1,clear:function(){this.paused=!1,this.handlers=[]},exec:function(){if(!this.paused)if(this.handlers.length){var t=this.handlers.shift(),n=t();if(n===!1)return this.callbacks.cancel();if(n===!0)return this.callbacks.pause();this.exec()}else this.callbacks.end();return this},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this.exec()}},n["default"]={create:function(t,n,e){var i=[],a=t.scope,c=t.state,f=t.actions.get(n)[c],h={cancel:t.cancel.bind(t),pause:t.pause.bind(t),resume:t.resume.bind(t),end:t.end.bind(t)};if((0,u.isFunction)(f)){var l=t.getActionsFor(),d=f.apply(a,[l].concat(e)),p=t.getActionsFor(d);if(!p)throw new Error('Cannot go to state "'+d+'" from current state "'+c+'"')}return t.config.order.map(function(s){var u=s.split(":"),l=r(u,2),d=l[0],p=l[1],v=/^(start|end)$/.test(d)?"action":"state",y=void 0;y="*"===p?"*":"action"==v?n:"leave"===d?c:f;var g=[v,y,d].join("."),m=t.handlers.get(g);m&&(m=m.map(function(t){return function(){var n=o["default"].create(v,d,y,c,f,h);t.apply(a,[n].concat(e))}}),i=i.concat(m))}),new s(n,c,f,i,h)}}},function(t,n){"use strict";function e(){}function i(t,n,e,i,s,r,a){t.namespace=n,t.type=e,t.target=i,t.from=s,t.to=r,t.pause=a.pause,t.resume=a.resume,t.cancel=a.cancel,t.complete=a.complete}function s(t,n,e,s,r){i(this,"action",t,n,e,s,r)}function r(t,n,e,s,r){i(this,"state",t,n,e,s,r)}function a(t){this.type=t}function o(t){this.type=t}Object.defineProperty(n,"__esModule",{value:!0}),n.ActionEvent=s,n.StateEvent=r,n.SystemEvent=a,n.TransitionEvent=o;var u={namespace:null,type:null,target:null,from:null,to:null,pause:e,resume:e,cancel:e,complete:e};n["default"]={create:function(t,n,e,i,a,o){var u="state"==t?r:s;return new u(n,e,i,a,o)}},s.prototype=u,r.prototype=u,a.prototype={namespace:"system",type:""},o.prototype={namespace:"transition",type:""}}])});
//# sourceMappingURL=state-machine.min.js.map