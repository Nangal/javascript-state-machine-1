!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("StateMachine",[],n):"object"==typeof exports?exports.StateMachine=n():t.StateMachine=n()}(this,function(){return function(t){function n(i){if(e[i])return e[i].exports;var s=e[i]={exports:{},id:i,loaded:!1};return t[i].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function s(t,n){if(1==arguments.length){var e=[t,null];n=e[0],t=e[1]}this.scope=t,this.state="",this.states=[],this.transitions=new c["default"],this.actions=new c["default"],this.handlers=new c["default"],n&&this.initialize(n)}function r(t,n){(0,l.isString)(n)&&t.states.indexOf(n)===-1&&t.states.push(n)}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,n){var e=[],i=!0,s=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(i=(a=o.next()).done)&&(e.push(a.value),!n||e.length!==n);i=!0);}catch(u){s=!0,r=u}finally{try{!i&&o["return"]&&o["return"]()}finally{if(s)throw r}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n["default"]=s;var u=e(1),c=i(u),h=e(3),f=i(h),d=e(4),l=e(2),p=e(5);s.parse=p.parse,s.prototype={states:null,transitions:null,actions:null,handlers:null,state:"",transition:null,scope:null,config:null,initialize:function(t){var n=this;if(this.config=t,t.scope&&(this.scope=t.scope),t.transitions&&!function(){var e=function(t,n){return new Error('Invalid transition shorthand pattern "'+t+'" - '+n)},i=function(t,n,e){s.push({name:t,from:n,to:e})},s=[];t.transitions.map(function(t){(0,l.isString)(t)?!function(){if(t=t.replace(/([|=:<>])/g," $1 ").replace(/\s+/g," ").replace(/^\s+|\s+$/g,""),!/^\w+ [:|=] \w[\w ]*[<>] \w[\w ]*/.test(t))throw e(t,"cannot determine action and states");for(var n=t.match(/([*\w ]+|[<>])/g),s=n.shift().replace(/\s+/g,""),r=[],a="",u="",c="",h="";n.length;)if(a=n.shift(),/[<>]/.test(a)?u=a:(a=a.match(/[*\w]+/g),a=1===a.length?a[0]:a,r.push(a)),2===r.length){var f="<"===u?[r[1],r[0]]:r,d=o(f,2);if(c=d[0],h=d[1],Array.isArray(c)&&Array.isArray(h))throw e(t,"transitioning between 2 arrays doesn't make sense");Array.isArray(c)?c.map(function(t){return i(s,t,h)}):Array.isArray(h)?h.map(function(t){return i(s,c,t)}):i(s,c,h),r.shift()}}():s.push(t)}),s.map(function(t){[t.from,t.to].map(function(t){return r(n,t)})}),t.initial||(t.initial=n.states[0]),Array.isArray(s)&&s.map(function(t){n.add(t.name,t.from,t.to)})}(),t.handlers)for(var e in t.handlers)t.handlers.hasOwnProperty(e)&&this.on(e,t.handlers[e]);t.defer||(this.state=t.initial),t.defaults=Object.assign({initialize:"initialize",action:"start",state:"enter"},t.defaults),t.order=t.order||["action.*.start","action.{action}.start","state.{*}.{action}","state.{from}.{action}","state.{from}.leave","state.*.leave","state.*.enter","state.{to}.enter","action.{action}.end","action.*.end"]},update:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=t+"."+n,r="system"===t?new d.SystemEvent(n,e,i):new d.TransitionEvent(n);return this.dispatch(s,r),this},"do":function(t){if(this.can(t)&&!this.isPaused()){for(var n=arguments.length,e=Array(n>1?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];return this.transition=f["default"].create(this,t,e),t===this.config.defaults.initialize&&this.update("system","initialize"),this.update("system","update","transition",this.transition),this.transition.exec(),!0}return!1},go:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.has(t)){if(n)return this.transition=f["default"].force(this,t),this.end();var e=this.getActionForState(t);if(e)return this["do"](e);this.config.debug&&console.info('No transition exists from "%s" to "%s"',this.state,t)}else this.config.debug&&console.warn('No such state "%s"',t);return!1},can:function(t){return this.actions.has(t)||this.config.debug&&console.warn('No such action "%s"',t),!!this.transitions.has(this.state,t)},cannot:function(t){return!this.can(t)},is:function(t){return this.states.indexOf(t)===-1&&this.config.debug&&console.warn('No such state "%s"',t),t===this.state},has:function(t){return this.states.indexOf(t)!==-1},getStatesFor:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t=t||this.state;var n=this.getActionsFor(t,!0);return Object.keys(n).map(function(t){return n[t]})},getActionsFor:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=n||this.state;var i=this.transitions.get(n||this.state);if(!e)return i;var s=function(){var e={};return i.map(function(i){e[i]=t.actions.get(i+"."+n)}),{v:e}}();return"object"===("undefined"==typeof s?"undefined":a(s))?s.v:void 0},getActionForState:function(t){if(this.has(t)){var n=this.getActionsFor(t,!0);for(var e in n)if(n[e]===t)return e}return null},isStarted:function(){return""!==this.state},isTransitioning:function(){return!!this.transition},isPaused:function(){return!!this.transition&&this.transition.paused},isComplete:function(){return this.state===this.config["final"]},pause:function(){return this.transition&&!this.isPaused()&&(this.transition.pause(),this.update("transition","pause"),this.update("system","update","pause",!0)),this},resume:function(){return this.transition&&this.isPaused()&&(this.update("transition","resume"),this.update("system","update","pause",!1),this.transition.resume()),this},cancel:function(){return this.transition&&(this.isPaused()&&this.update("system","update","pause",!1),this.state=this.transition.from,this.transition.clear(),delete this.transition,this.update("transition","cancel"),this.update("system","update","transition",null)),this},end:function(){return this.transition&&(this.isPaused()&&this.update("system","update","pause",!1),this.state=this.transition.to,this.transition.clear(),delete this.transition,this.update("system","change","state",this.state),this.update("system","update","state",this.state),this.isComplete()&&this.update("system","complete"),this.update("system","update","transition",null)),this},reset:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=t||this.config.initial;return this.update("system","reset"),this.transition&&(this.isPaused()&&this.update("system","update","pause",!1),this.transition.clear(),delete this.transition,this.update("transition","cancel"),this.update("system","update","transition",null)),this.state!==n&&(this.state=n,this.update("system","change","state",this.state),this.update("system","update","state",this.state)),this},add:function(t,n,e){return this.actions.set(t+"."+n,e),this.transitions.add(n,t),r(this,n),r(this,e),this},remove:function(t,n,e){return this.states.remove(t,n),this},on:function(t,n){var e=this,i=(0,p.parse)(this,t);return this.config.debug&&console.log("StateMachine on: "+t,[i.namespace,i.type],i.paths),i.paths.map(function(t,s){var r=i.targets[s];if("*"!==r&&("state"===i.namespace?e.states.indexOf(r)===-1&&e.config.debug&&console.warn('StateMachine: Warning assigning state.%s handler; no such state "%s"',i.type,r):"action"===i.namespace&&(e.actions.has(r)||e.config.debug&&console.warn('StateMachine: Warning assigning action.%s handler; no such action "%s"',i.type,r))),!(0,l.isFunction)(n))throw new Error("Error assigning "+i.namespace+"."+i.type+" handler; callback is not a Function",n);e.handlers.insert(t,n)}),this},off:function(t,n){var e=this,i=(0,p.parse)(this,t);i.paths.map(function(t){e.handlers.remove(t,n)})},dispatch:function(t,n){var e=this;this.config.debug&&console.info('StateMachine: dispatch "%s"',t);var i=this.handlers.get(t);i&&i.map(function(t){return t(n,e)})}}},function(t,n,e){"use strict";function i(t){this.data=t||{}}function s(t,n){for(var e=void 0;n.length;)e=n.shift(),(0,l.isObject)(t[e])||(t[e]={}),t=t[e];return t}function r(t,n,e){var i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,String(n).split(".")),r=i.pop();t=s(t,i),t[r]=e}function a(t,n,e){var i=String(n).split("."),r=i.pop();t=s(t,i),(0,l.isArray)(t[r])||(t[r]=[]),t[r].push(e)}function o(t,n,e){var i=String(n).split("."),r=i.pop();t=s(t,i),(0,l.isArray)(t[r])||(t[r]=[]);var a=t[r],o=a.indexOf(e);o===-1?a.push(e):a[o]=e}function u(t,n){if((0,l.isUndefined)(n)||""==n)return t;for(var e=void 0,i=String(n).split(".");i.length>1;){if(e=i.shift(),!t.hasOwnProperty(e))return;t=t[e]}return e=i.shift(),t[e]}function c(t,n,e){var i=u(t,n);return!!((0,l.isArray)(i)&&(0,l.isDefined)(e)?i.indexOf(e)!==-1:(0,l.isUndefined)(e)?(0,l.isDefined)(i):i===e)}function h(t,n,e){var i=u(t,n);return(0,l.isArray)(i)?i.indexOf(e):-1}function f(t,n,e){var i=t,s=String(n||"").split("."),r=s.pop();if(s.length&&(i=u(t,s.join("."))),(0,l.isDefined)(e)&&(0,l.isArray)(i[r])){var a=i[r],o=a.indexOf(e);return o>-1&&(a.splice(o,1),0===a.length&&delete i[r],!0)}return!(!(0,l.isObject)(i)||!t.hasOwnProperty(r))&&(delete i[r],!0)}function d(t,n){var e=[],i=u(t,n);if((0,l.isObject)(i))for(var s in i)i.hasOwnProperty(s)&&e.push(i[s]);return e}Object.defineProperty(n,"__esModule",{value:!0}),n.values=n.remove=n.indexOf=n.has=n.get=n.set=void 0,n["default"]=i;var l=e(2);i.prototype={data:null,set:function(t,n){return r(this.data,t,n),this},add:function(t,n){return a(this.data,t,n),this},insert:function(t,n){return o(this.data,t,n),this},get:function(t){return u(this.data,t)},has:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return c(this.data,t,n)},indexOf:function(t,n){return h(this.data,t,n)},remove:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return f(this.data,t,n),this},keys:function(t){return Object.keys(u(this.data,t))},values:function(t){return d(this.data,t)}},n.set=r,n.get=u,n.has=c,n.indexOf=h,n.remove=f,n.values=d},function(t,n){"use strict";function e(t){return"[object Object]"===Object.prototype.toString.call(t)}function i(t){return t instanceof Array}function s(t){return"string"==typeof t}function r(t){return t instanceof Function}function a(t){return"undefined"!=typeof t}function o(t){return"undefined"==typeof t}function u(t){return String(t||"").replace(/^\s+|\s+$/g,"")}Object.defineProperty(n,"__esModule",{value:!0}),n.isObject=e,n.isArray=i,n.isString=s,n.isFunction=r,n.isDefined=a,n.isUndefined=o,n.trim=u},function(t,n,e){"use strict";function i(t,n,e,i){this.fsm=t,this.action=n,this.from=e,this.to=i,this.clear()}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,n){var e=[],i=!0,s=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(i=(a=o.next()).done)&&(e.push(a.value),!n||e.length!==n);i=!0);}catch(u){s=!0,r=u}finally{try{!i&&o["return"]&&o["return"]()}finally{if(s)throw r}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=e(4),a=e(2);i.prototype={fsm:null,action:"",from:"",to:"",paused:!1,handlers:null,clear:function(){this.paused=!1,this.handlers=[]},exec:function(){if(!this.paused)if(this.handlers.length){var t=this.handlers.shift(),n=t();if(n===!1)return this.fsm.cancel();if(n===!0)return this.fsm.pause();this.exec()}else this.fsm.end();return this},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this.exec()}},n["default"]={create:function(t,n,e){var o=t.scope,u=t.state,c=t.actions.get(n)[u],h={action:n,to:c,from:u};if((0,a.isFunction)(c)&&(c=c.apply(o,e),t.states.indexOf(c)===-1))throw new Error('Invalid "to" state "'+c+'"');var f=[],d=new i(t,n,u,c);return t.config.order.map(function(n){n=n.replace(/{(\w+)}/g,function(t,n){return h[n]});var i=t.handlers.get(n);i&&!function(){var a=n.split("."),u=s(a,3),c=u[0],h=u[1],l=u[2];i=i.map(function(n){var i="state"===c?r.StateEvent:r.ActionEvent,s=new i(l,h,d);return function(){return n.apply(o,[s,t].concat(e))}}),f=f.concat(i)}()}),d.handlers=f,d},force:function(t,n){var e=new i(t,"",t.state,n);return e.paused=!!t.transition&&t.transition.paused,e}}},function(t,n){"use strict";function e(t,n,e,i,s){t.namespace=n,t.type=e,t.target=i,t.transition=s}function i(t,n,i){e(this,"action",t,n,i)}function s(t,n,i){e(this,"state",t,n,i)}function r(t,n,e){this.type=t,this.key=n,this.value=e}function a(t){this.type=t}Object.defineProperty(n,"__esModule",{value:!0}),n.ActionEvent=i,n.StateEvent=s,n.SystemEvent=r,n.TransitionEvent=a;var o={namespace:null,type:null,target:null,transition:null};i.prototype=o,s.prototype=o,r.prototype={namespace:"system",type:"",key:"",value:null},a.prototype={namespace:"transition",type:""}},function(t,n){"use strict";function e(t,n){function e(n){return t.states.indexOf(n)!==-1}function r(n){return t.actions.has(n)}function a(t){return t?t.match(/\w[-\w]*/g):["*"]}function o(t){/^(system|transition|state|action)$/.test(t)?h=t:t in s.namespaces?(h=s.namespaces[t],f=t):e(t)||r(t)?(h||(h=e(t)?"state":"action"),"state"===h&&r(t)&&(f=t),d||(d=a(t))):/^(enter|leave)$/.test(t)&&(f=t)}var u=t.config.defaults,c=void 0,h=void 0,f=void 0,d=void 0;return(c=n.match(/:\w+|@\w+|\(.+?\)|\.\w+|\w+/g))?(c.forEach(function(t,n,i){var r=t[0],a=t.match(/\w+/g),u=a[0];switch(r){case":":h=s.events[u],f=u;break;case"@":h="state",f=u;break;case"(":d=a,h=e(a[0])?"state":"action";break;case".":o(u);break;default:o(t)}}),d||(d=a()),h||(h=e(d[0])?"state":"action"),f||(f=u[h]),new i(h,f,d)):new i}function i(t,n,e){t&&(this.namespace=t,this.type=n,this.targets=e,this.paths=e.map(function(e){return"action"===t||"state"===t?[t,e,n].join("."):t+"."+n}))}Object.defineProperty(n,"__esModule",{value:!0}),n.parse=e;var s={namespaces:{start:"system",change:"system",update:"system",complete:"system",reset:"system",add:"system",remove:"system",pause:"transition",resume:"transition",cancel:"transition"},events:{start:"action",end:"action",enter:"state",leave:"state"}};i.prototype={namespace:"",type:"",targets:[],paths:[]}}])});
//# sourceMappingURL=state-machine.min.js.map