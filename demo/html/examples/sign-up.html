<!DOCTYPE html>
<html lang="en">
<head>
    <title>Sign-up form</title>
    <script src="/assets/vendor/jquery.min.js"></script>
    <link  href="/assets/vendor/bootstrap.min.css" rel="stylesheet" >
    <script src="/assets/js/state-machine.js"></script>
    <script src="/assets/js/setup.js"></script>
    <link  href="/assets/css/styles.css" rel="stylesheet">
</head>
<body>

    <h1>Sign-up form</h1>

    <main class="steps">

        <section id="states">

            <article id="intro">
                <h2>Welcome</h2>
                <p>Lorem ipsum dolor sit amet, eos accusam evertitur ut. Meliore placerat elaboraret cu sit, cu est sonet ornatus, at mea sint velit. Et ius iriure deleniti persequeris, idque diceret ei usu. Eu has novum graeci.</p>
                <p>Click "next" to get started</p>
            </article>

            <article id="form">

                <h2>Sign-up</h2>

                <form class="form-horizontal">

                    <fieldset>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="email">Email</label>
                            <div class="col-md-9">
                                <input id="email" name="email" type="email" placeholder="Email" class="form-control input-md" required="">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="password">Password</label>
                            <div class="col-md-9">
                                <input id="password" name="password" type="password" placeholder="Password" class="form-control input-md" required="">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="terms"></label>
                            <div class="col-md-9">
                                <label class="checkbox-inline" for="terms">
                                    <input type="checkbox" name="terms" id="terms" value="1">
                                    Agree terms and conditions
                                </label>
                            </div>
                        </div>

                    </fieldset>

                </form>

            </article>

            <article id="finish">
                <h2>Thank you!</h2>
                <p>Your membership information has been emailed to you</p>
            </article>

            <article id="error">
                <h2 style="color:red">Sorry</h2>
                <p>There was a problem saving your details to the server</p>
            </article>

        </section>

        <section>
            <label><input id="invalid" type="checkbox"> Simulate server error</label>
        </section>

        <section id="controls">
            <button class="btn btn-sm" name="back">Back</button>
            <button class="btn btn-sm" name="next">Next</button>
            <button class="btn btn-sm" name="exit">Finish</button>
        </section>

    </main>

    <section id="info">
        <p>This example demonstrates various processes for a multi-step form:</p>
        <ul>
            <li>A conditional transition when validating the form</li>
            <li>An asynchronous transition when submitting the form</li>
            <li>A forced transition to an "error" state via <code>go()</code></li>
            <li>A terminating state "done"</li>
        </ul>
    </section>

    <script>

        function validate ()
        {
            var validated = true;
            $('#form input').each(function(i, e)
            {
                var valid = e.type === 'checkbox'
                    ? e.checked
                    : e.value !== '';
                if(!valid)
                {
                    validated = false;
                }
                $(e)
                    .closest('.form-group')
                    .toggleClass('has-error', ! valid);
            });
            return validated;
        }

        var config = {

            transitions:
            [
                // next:   intro > form > finish
                // back:   intro < form
                // error:          form          > error

                {name: 'next', from: 'intro', to: 'form'},
                {name: 'next', from: 'form',  to: 'finish'},

                {name: 'back', from: 'form',  to: 'intro'},
                {name: 'back', from: 'error', to: 'form'},
                {name: 'exit', from: 'finish', to: 'intro'},

                {name: 'error', from: 'form', to: 'error'}
            ],

            handlers:
            {
                'form:enter':function ()
                {
                    $('form').removeClass('has-error');
                },

                'form@next': function (event, fsm)
                {
                    // validate
                    if (!validate()) {
                        console.log('The form is invalid');
                        return fsm.cancel();
                    }

                    // submit
                    fsm.pause();
                    setTimeout(function ()
                    {
                        if(document.getElementById('invalid').checked)
                        {
                            console.log('There was an error submitting your data!');
                            fsm.go('error', true);
                        }
                        else
                        {
                            console.log('Data submitted!');
                            fsm.resume();
                        }
                    }, 2000);
                }
            }
        };

        setup(new StateMachine(config));

    </script>
</body>
</html>