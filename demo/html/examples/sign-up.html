<!DOCTYPE html>
<html lang="en">
<head>
    <title>Using handlers to guard states</title>
    <script src="/assets/vendor/jquery.min.js"></script>
    <link  href="/assets/vendor/bootstrap.min.css" rel="stylesheet" >
    <script src="/assets/js/state-machine.js"></script>
    <script src="/assets/js/setup.js"></script>
    <link  href="/assets/css/styles.css" rel="stylesheet">
</head>
<body>

    <h1>Using handlers to guard states</h1>

    <main class="steps">

        <section id="states">

            <article id="intro">
                <h2>Welcome</h2>
                <p>Lorem ipsum dolor sit amet, eos accusam evertitur ut. Meliore placerat elaboraret cu sit, cu est sonet ornatus, at mea sint velit. Et ius iriure deleniti persequeris, idque diceret ei usu. Eu has novum graeci.</p>
                <p>Click "next" to get started</p>
            </article>

            <article id="form">

                <h2>Sign-up</h2>

                <form class="form-horizontal">

                    <fieldset>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="email">Email</label>
                            <div class="col-md-9">
                                <input id="email" name="email" type="email" placeholder="Email" class="form-control input-md" required="">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="password">Password</label>
                            <div class="col-md-9">
                                <input id="password" name="password" type="password" placeholder="Password" class="form-control input-md" required="">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="terms"></label>
                            <div class="col-md-9">
                                <label class="checkbox-inline" for="terms">
                                    <input type="checkbox" name="terms" id="terms" value="1">
                                    Agree terms and conditions
                                </label>
                            </div>
                        </div>

                    </fieldset>

                </form>

            </article>

            <article id="finish">
                <h2>Thank you!</h2>
                <p>Your membership information has been emailed to you</p>
            </article>

            <article id="error">
                <h2>Sorry</h2>
                <p>There was a problem saving your details to the server</p>
            </article>

        </section>

        <section id="controls">
            <button class="btn btn-sm" name="back">Back</button>
            <button class="btn btn-sm" name="next">Next</button>
        </section>

    </main>

    <section id="info">
        <p>This example demonstrates a multi-step form, with guarded and asynchronous transitions.</p>
    </section>

    <script>

        function validate ()
        {
            var state = !! (email.value !== '' && password.value !== '' && terms.checked);
            $('form').toggleClass('has-error', ! state);
            return state;
        }

        var config = {

            events:
            [
                // next:   intro > form > finish
                // back:   intro < form
                // error:          form          > error

                {name: 'next', from: 'intro', to: 'form'},
                {name: 'next', from: 'form',  to: 'finish'},

                {name: 'back', from: 'form',  to: 'intro'},
                {name: 'back', from: 'error', to: 'form'},

                {name: 'error', from: 'form', to: 'error'}
            ],

            handlers:
            {
                'leave:form': function (event)
                {
                    // validate
                    if (!validate()) {
                        return event.cancel();
                    }

                    // submit
                    event.pause();
                    setTimeout(function(){
                        console.log('Data submitted!');
                        event.resume();
                    }, 2000);
                }
            }
        };

        setup(new StateMachine(document, config));

    </script>
</body>
</html>