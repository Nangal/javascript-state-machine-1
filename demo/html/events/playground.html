<!DOCTYPE html>
<html lang="en">
<head>
    <title>Event handler playground</title>
    <script src="/assets/vendor/jquery.min.js"></script>
    <link  href="/assets/vendor/bootstrap.min.css" rel="stylesheet" >
    <script src="/assets/js/state-machine.js"></script>
    <script src="/assets/js/setup.js"></script>
    <link  href="/assets/css/styles.css" rel="stylesheet">
    <style>
        #log {
            position:absolute;
            top:0;
            right:0;
            width:290px;
            height:465px;
            border:1px solid #CCC;
            padding:15px;
            overflow: hidden;
            line-height: 1.2em;
            font-size:0.8em;
            font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
            white-space: nowrap;
        }

        #log p { margin:0; }

        .system { color: black; }
        .transition { color: blue; }
        .action { color: red; }
        .state { color: green; }

        #log hr {
            margin:10px 0;
        }

        #log span{
            display: inline-block;
        }

        #log span.index {
            width:25px;
            margin-right: 10px;
            text-align: right;
        }

        #log span.message {
            margin-left:10px;
        }

        #control-set > section {
            display: inline-block;
        }

        #handlers {
            position: relative;
        }

        #handlers > fieldset {
            display: inline-block;
            vertical-align: top;
            padding-right:30px;
        }

        fieldset > label{
            display: block;
        }

        legend {
            font-size:1.2em;
            margin-bottom:0.5em;
        }

        #control-set > section {
            display: inline-block;
        }

    </style>
</head>
<body>

    <h1>Event handler playground</h1>

    <main class="states">

        <section id="log">

        </section>

        <section id="states">
            <article id="a">State A</article>
            <article id="b">State B</article>
            <article id="c">State C<br>(async. entry)</article>
        </section>

        <section id="handlers">

            <fieldset>
                <legend class="system">System</legend>
                <label><input type="checkbox" name="system" value="system.start"> start</label>
                <label><input type="checkbox" name="system" value="system.change"> change</label>
                <label><input type="checkbox" name="system" value="system.update"> update</label>
                <label><input type="checkbox" name="system" value="system.complete"> complete</label>
                <label><input type="checkbox" name="system" value="system.reset"> reset</label>
            </fieldset>

            <fieldset>
                <legend class="action">Action</legend>
                <label><input type="checkbox" name="action" value="start"> start</label>
                <label><input type="checkbox" name="action" value="end"> end</label>
                <label><input type="checkbox" name="action" value="start:next"> start:next</label>
                <label><input type="checkbox" name="action" value="end:next"> end:next</label>
                <label><input type="checkbox" name="action" value="start:back"> start:back</label>
                <label><input type="checkbox" name="action" value="end:back"> end:back</label>
            </fieldset>

            <fieldset>
                <legend class="state">State</legend>
                <label><input type="checkbox" name="state" value="enter"> enter</label>
                <label><input type="checkbox" name="state" value="leave"> leave</label>
                <label><input type="checkbox" name="state" value="leave:a"> leave:a</label>
                <label><input type="checkbox" name="state" value="enter:b"> enter:b</label>
                <label><input type="checkbox" name="state" value="leave:b c"> leave:b c</label>
                <label><input type="checkbox" name="state" value="next:a b"> next:a b</label>
                <label><input type="checkbox" name="state" value="a@next"> a@next</label>
                <label><input type="checkbox" name="state" value="a b@next"> a b@next</label>
                <label><input type="checkbox" name="state" value="a@leave"> a@leave</label>
                <label><input type="checkbox" name="state" value="add"> add</label>
                <label><input type="checkbox" name="state" value="remove"> remove</label>
            </fieldset>

            <fieldset>
                <legend class="transition">Transition</legend>
                <label><input type="checkbox" name="transition" value="transition.pause"> pause</label>
                <label><input type="checkbox" name="transition" value="transition.resume"> resume</label>
                <label><input type="checkbox" name="transition" value="transition.cancel"> cancel</label>
            </fieldset>

        </section>

        <div id="control-set">
            <section id="controls">
                <button class="btn btn-sm" name="start">Start</button>
                <button class="btn btn-sm" name="back">Back</button>
                <button class="btn btn-sm" name="next">Next</button>
            </section>

            <section id="more-controls">
                <button class="btn btn-sm" name="cancel">Cancel</button>
                <button class="btn btn-sm" name="reset">Reset</button>
                <button class="btn btn-sm" name="add">Add</button>
                <button class="btn btn-sm" name="remove">Remove</button>
            </section>
        </div>

    </main>

    <section id="info">
        <p>This example demonstrates the various events you can listen to and take action on:</p>
        <ul>
            <li>Toggle handlers for the events above using the checkboxes</li>
            <li>Use the buttons to navigate the flow</li>
            <li>Note the order and timing of events in the panel on the right</li>
        </ul>
        <p>Note that all handlers operate independently of one another:</p>
        <ul>
            <li>You can listen to global (all states, and all actions) as well as named events</li>
            <li>You can mix and match all event handler types to both control and react to your flow</li>
        </ul>
    </section>

    <script>

        var config = {

            debug: true,

            start: 'a',

            final: 'c',

            events:
            [
                {name: 'start', from: 'none', to: 'a'},

                {name: 'next', from: 'a', to: 'b'},
                {name: 'next', from: 'b', to: 'c'},
                {name: 'next', from: 'c', to: 'a'},

                {name: 'back', from: 'c', to: 'b'},
                {name: 'back', from: 'b', to: 'a'},
                {name: 'back', from: 'a', to: 'c'}
            ],

            handlers: {
                'enter:c': function (event) {
                    event.pause();
                    setTimeout(event.resume, 3000);
                },
                update: function (event) {

                }
            }
        };

        setup(new StateMachine(document, config));

    </script>

    <script>

        var handlers = {

            system: function (event) {
                var message = event.key
                    ? [event.key, event.value]
                    : '';
                log(event.namespace, event.type, message);
            },

            action: function (event) {
                log(event.namespace, event.type, event.target);

            },

            state: function (event) {
                log(event.namespace, event.type, event.target);
            },

            transition: function (event) {
                log(event.namespace, event.type);
            },

            target: function (event) {
                log(event.namespace, event.type, event.target);
            },

            cancel: function () {
                fsm.cancel();
            },

            reset: function () {
                fsm.reset();
            },

            add: function () {
                fsm.add()
            },

            remove: function () {

            }
        };

        $('input[type="checkbox"]').on('change', function (event) {
            var signature = event.target.value;
            var method = event.target.checked ? 'on' : 'off';
            var handler = signature.indexOf(':') == -1
                ? handlers[event.target.name]
                : handlers.target;
            fsm[method](signature, handler);
        });

        $('#control-set button').on('mouseup', function () {
            if($log[0].firstChild.tagName === 'P'){
                $log.prepend('<hr>');
            }
        });

        $('#more-controls button').on('click', function (event) {
            handlers[event.target.name]();
        });

        var index = 1;
        var $log = $('#log');
        function log(namespace, type, message) {
            message = message || '';
            var className = namespace+ ' ' +namespace+ '-' +type;
            var html =
            [
                '<span class="index">' +(index++)+ '</span>',
                '<span class="event">' +namespace+ '.' +type+ '</span>',
                '<span class="message"> ' +message+ '</span>'
            ];
            $log.prepend('<p class="' +className+ '">' +html.join('')+'</p>');
        }
    </script>
</body>
</html>