<!DOCTYPE html>
<html lang="en">
<head>
    <title>Automated id tester</title>
    <script src="/assets/vendor/jquery.min.js"></script>
    <link  href="/assets/vendor/bootstrap.min.css" rel="stylesheet" >
    <script src="/assets/js/StateMachine.js"></script>
    <script src="/assets/js/StateHelper.js"></script>
    <script src="/assets/js/setup.js"></script>
    <link  href="/assets/css/styles.css" rel="stylesheet">
    <style>
        table tr.section th {
            font-size: 1.1em;
            background: #FFF;
            border-bottom:1px solid #CCC;
            padding-top:1em;
        }
        tr.error {
            color: red;
        }
        .table > tbody > tr > td,
        .table > thead > tr > th {
            font-size: 0.9em;
            padding: 2px 6px;
        }
    </style>
</head>
<body>

    <h1>Automated id tester: </h1>

    <main class="states">

        <section>

            <p>This page just tests a variety of event handler ids and outputs the results.</p>

            <table class="table table-striped">
                <thead>
                <tr>
                    <th>id</th>
                    <th>expected</th>
                    <th>result</th>
                </tr>
                </thead>
                <tbody id="results"></tbody>
            </table>

        </section>

    </main>

    <script>

        // ------------------------------------------------------------------------------------------------
        // variables

            var fsm     = new StateMachine({ transitions: [ 'next : a > b' ] });
            var $table  = $('#results').empty();
            var data    = [];
            var count   = 0;


        // ------------------------------------------------------------------------------------------------
        // functions

            function addSection(text)
            {
                $table.append('<tr class="section"><th colspan="3">' +text+ '</th></tr>');
            }

            function add(id, expected)
            {
                data.push({id:id, expected:expected});
                $table.append('<tr><td>' +[id, expected, ''].join('</td><td>')+ '</td></tr>');
            }

            function test (input, index)
            {
                // variables
                var result, text, ok;

                // test
                try
                {
                    result  = fsm.parse(input.id);
                    text    = result.paths.join(' ');
                    ok      = input.expected == text;
                }
                catch(error)
                {
                    console.log(error, error.message);
                    text    = error.message;
                    ok      = input.expected == null;
                }

                if(ok)
                {
                    count++;
                }

                // debug
                //console.log(result);

                // render
                $table
                    .find('tr:not(.section)')
                    .eq(index)
                    .toggleClass('error', ! ok)
                    .find('td:eq(2)')
                    .text(text);
            }


        // ------------------------------------------------------------------------------------------------
        // add rows

            addSection('shortcuts');
            add('start', 'system.start');
            add('change', 'system.change');
            add('update', 'system.update');
            add('complete', 'system.complete');
            add('reset', 'system.reset');
            add('add', 'system.add');
            add('remove', 'system.remove');
            add('pause', 'transition.pause');
            add('resume', 'transition.resume');
            add('cancel', 'transition.cancel');

            addSection('absolute');
            add('system.start', 'system.start');
            add('transition.pause', 'transition.pause');

            addSection('actions');
            add('action', 'action.*.start');
            add('next', 'action.next.start');
            add('(next back)', 'action.next.start action.back.start');

            addSection('state & action types');
            add(':start', 'action.*.start');
            add(':end', 'action.*.end');
            add('next:start', 'action.next.start');
            add('next:end', 'action.next.end');
            add('action.next:end', 'action.next.end');
            add('(next back):end', 'action.next.end action.back.end');

            addSection('actions');
            add('a.next', 'state.a.next');
            add('a:leave', 'state.a.leave');
            add('(a b).next', 'state.a.next state.b.next');
            add('state.(a b).next', 'state.a.next state.b.next');

            addSection('states');
            add('state', 'state.*.enter');
            add('a', 'state.a.enter');
            add(':enter', 'state.*.enter');
            add(':leave', 'state.*.leave');
            add('a:leave', 'state.a.leave');
            add('(b c):enter', 'state.b.enter state.c.enter');

            addSection('states + actions');
            add('@next', 'action.next.start');
            add('a@next', 'state.a.next');
            add('(a b c)@next', 'state.a.next state.b.next state.c.next');

            addSection('errors');
            add('blah');
            add('a.leave');
            add('a:hello');
            add('state.action');
            add('state.next:end');
        /*
        */

        // ------------------------------------------------------------------------------------------------
        // test

            setTimeout(function(){
                data.map(test);
                $('h1').append(count + '/' + data.length);
            }, 100);

    </script>


</body>
</html>