<!DOCTYPE html>
<html lang="en">
<head>
    <title>Interactive id tester</title>
    <script src="/assets/vendor/jquery.min.js"></script>
    <script src="/assets/vendor/bootstrap.min.js"></script>
    <link  href="/assets/vendor/bootstrap.min.css" rel="stylesheet" >
    <script src="/assets/js/StateMachine.js"></script>
    <script src="/assets/js/StateHelper.js"></script>
    <script src="/assets/js/setup.js"></script>
    <link  href="/assets/css/styles.css" rel="stylesheet">
    <style type="text/css">
        pre{
            margin:0;
            color:#333;
            font-size: 12px;
        }
    </style>

    <style>
        .indent {
            margin-left:30px;
        }

        .table > tbody > tr > td,
        .table > thead > tr > th {
            padding: 4px 6px;
        }

        table code {
            font-size:0.8em;
        }
    </style>

</head>
<body>

    <h1>Interactive id tester</h1>

    <main class="states">

        <section id="app">

            <div class="form-group">
                <div class="input-group">
                    <input id="id" type="text" placeholder="Type a valid event handler id here..." class="form-control input-md">

                    <div class="input-group-btn">
                        <button type="button"
                                data-toggle="dropdown"
                                class="btn btn-default dropdown-toggle"
                                >Examples... <span class="caret"></span></button>
                        <ul id="examples" class="dropdown-menu dropdown-menu-right">
                            <li><a href="#">a</a></li>
                            <li><a href="#">a:leave</a></li>
                            <li><a href="#">:leave</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">@next</a></li>
                            <li><a href="#">@next:end</a></li>
                            <li><a href="#" title="Special case: target an action on a state">a@next</a></li>
                            <li><a href="#">:end</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">change</a></li>
                            <li><a href="#">pause</a></li>
                            <li><a href="#">transition.pause</a></li>
                            <li><a href="#">action.add</a></li>
                            <li><a href="#">state.remove</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">(a b)</a></li>
                            <li><a href="#">(a b c)@next</a></li>
                            <li><a href="#">(a b c)@(next back)</a></li>
                            <li><a href="#">(pause resume)</a></li>
                            <li><a href="#">(change pause a @next)</a></li>
                        </ul>
                    </div>

                </div>
            </div>

            <div id="errors" class="form-group">
                <label class="radio-inline" style="padding-left: 10px">Invalid states / actions:</label>
                <label class="radio-inline">
                    <input type="radio" name="errors" value="0" checked> Ignore
                </label>
                <label class="radio-inline">
                    <input type="radio" name="errors" value="1"> Warn
                </label>
                <label class="radio-inline">
                    <input type="radio" name="errors" value="2"> Error
                </label>
            </div>

            <div class="indent">
                <pre class="well well-sm" id="results">Awaiting input...</pre>
            </div>

        </section>

        <section id="info">

            <p>This page allows you to test out some event handler ids of your own. Type above or use the examples to test out some matches!</p>

            <p>A StateMachine instance is instantiated with the following properties available:</p>
            <ul>
                <li>States: <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>, <code>e</code>, <code>exit</code></li>
                <li>Actions: <code>back</code>, <code>next</code>, <code>quit</code></li>
            </ul>

            <p>The following grammar is available:</p>

            <div class="indent">

                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Format</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>&lt;any&gt;</code></td>
                            <td>Any single word that resolves to a namespaced-type alias, action or state name</td>
                        </tr>
                        <tr>
                            <td><code>&lt;namespace&gt;.&lt;type&gt;</code></td>
                            <td>A namespaced-type, for system, transition, action or state</td>
                        </tr>
                        <tr>
                            <td><code>:&lt;type&gt;</code></td>
                            <td>An event type, for action or state events</td>
                        </tr>
                        <tr>
                            <td><code>@&lt;action&gt;</code></td>
                            <td>An action name</td>
                        </tr>
                        <tr>
                            <td><code>#&lt;state&gt;</code></td>
                            <td>A state name (provided in case you need to disambiguate from a namespaced alias)</td>
                        </tr>
                        <tr>
                            <td><code>(&lt;foo&gt; &lt;bar&gt; &lt;baz&gt;)</code></td>
                            <td>Grouping for multiple grammars, which are expanded to multiple paths</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p>The "Invalid states / actions" option mimics the <code>errors</code> value you can set in config to determine which way to handle missing states or actions.</p>

        </section>

    </main>

    <script>

        // ------------------------------------------------------------------------------------------------
        // setup

            var handlerId = '';

            var error = 0;

            var fsm = new StateMachine({

                transitions: [
                    'next : a > b > c > d > e',
                    'back : a < b < c < d < e',
                    'quit : a b c d e > exit'
                ]

            });

            function update()
            {
                try
                {
                    // get results
                    var results  = fsm.parse(handlerId, error)
                        .map(function(result) {
                            delete result.id;
                            return result;
                        });

                    // show code
                    $results.html(JSON.stringify(results, null, '    '));

                    // save
                    localStorage.handlerId = handlerId;
                }
                catch(error)
                {
                    $results.html(error.message);
                }
            }


        // ------------------------------------------------------------------------------------------------
        // elements

            var $results = $('#results');

            var $id = $('#id')
                .val(localStorage.handlerId || '')
                .on('input', function (event) {
                    handlerId = event.target.value;
                    update();
                })
                .trigger('input')
                .focus();

            $('#examples a')
                .on('click', function(event)
                {
                    event.preventDefault();
                    handlerId = $(event.target).text();
                    $id.val(handlerId);
                    update()
                });

            $('input[name="errors"]')
                .on('click', function(event)
                {
                    error = parseInt(event.target.value);
                    update();
                });


    </script>


</body>
</html>